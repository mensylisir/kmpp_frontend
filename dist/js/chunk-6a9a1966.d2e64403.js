(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a9a1966"],{"1a55":function(t,e,a){"use strict";a("2a6b")},"2a6b":function(t,e,a){t.exports={theme:"#5354bb"}},"30d5":function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));a("79fd"),a("45af"),a("b1fa"),a("1ec5"),a("2e6f"),a("af21");var n=a("ec81");function s(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=Object(n["a"])(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var s=0,c=function(){};return{s:c,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,i=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return r=t.done,t},e:function(t){i=!0,o=t},f:function(){try{r||null==a["return"]||a["return"]()}finally{if(i)throw o}}}}},"78d4":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"86ca":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"complex-table"},[t.$slots.header||t.header?a("div",{staticClass:"complex-table__header"},[t._t("header",(function(){return[t._v(t._s(t.header))]})),t.$slots.toolbar||t.searchConfig?a("div",{staticClass:"complex-table__toolbar"},[a("div",[t._t("toolbar")],2),a("fu-search-bar",t._b({on:{exec:t.search},scopedSlots:t._u([{key:"complex",fn:function(){return[t._t("complex")]},proxy:!0}],null,!0)},"fu-search-bar",t.searchConfig,!1),[t._t("buttons"),a("fu-table-column-select",{attrs:{columns:t.columns}})],2)],1):t._e()],2):t._e(),a("div",{staticClass:"complex-table__body"},[a("fu-table",t._g(t._b({attrs:{columns:t.columns,"local-key":t.localKey},on:{"selection-change":t.handleSelectionChange}},"fu-table",t.$attrs,!1),t.$listeners),[t._t("default")],2)],1),t.$slots.pagination||t.paginationConfig?a("div",{staticClass:"complex-table__pagination"},[t._t("pagination",(function(){return[a("fu-table-pagination",t._b({attrs:{"current-page":t.paginationConfig.currentPage,"page-size":t.paginationConfig.pageSize},on:{"update:currentPage":function(e){return t.$set(t.paginationConfig,"currentPage",e)},"update:current-page":function(e){return t.$set(t.paginationConfig,"currentPage",e)},"update:pageSize":function(e){return t.$set(t.paginationConfig,"pageSize",e)},"update:page-size":function(e){return t.$set(t.paginationConfig,"pageSize",e)},change:t.search}},"fu-table-pagination",t.paginationConfig,!1))]}))],2):t._e()])},s=[],c={name:"ComplexTable",props:{columns:{type:Array,default:function(){return[]}},localKey:String,header:String,searchConfig:Object,paginationConfig:Object,selects:Array},data:function(){return{condition:{}}},methods:{search:function(t,e){t&&(this.condition=t),this.$emit("search",this.condition,e)},handleSelectionChange:function(t){this.$emit("update:selects",t)}}},o=c,r=(a("1a55"),a("5d22")),i=Object(r["a"])(o,n,s,!1,null,null,null);e["a"]=i.exports},ecf1:function(t,e,a){"use strict";var n=a("6c87"),s=a("9f69"),c=a("e08f"),o=a("78d4"),r=a("1392");n("search",(function(t,e,a){return[function(e){var a=c(this),n=void 0==e?void 0:e[t];return void 0!==n?n.call(e,a):new RegExp(e)[t](String(a))},function(t){var n=a(e,this,t);if(n.done)return n.value;var c=s(this),i=String(t),l=c.lastIndex;o(l,0)||(c.lastIndex=0);var u=r(c,i);return o(c.lastIndex,l)||(c.lastIndex=l),null===u?-1:u.index}]}))},efb9:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-bottom":"30px"},attrs:{"tab-position":"left"},on:{"tab-click":function(e){return t.handleClick()}},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_recover"),name:t.$t("cluster.detail.backup.backup_recover")}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("el-form",{ref:"strategyForm",attrs:{model:t.strategyForm,rules:t.rules,"label-width":"150px","label-position":"left"}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.backup_strategy")))])]),a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_interval"),prop:"cron"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.cron,callback:function(e){t.$set(t.strategyForm,"cron",t._n(e))},expression:"strategyForm.cron"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.retained_number"),prop:"saveNum"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.saveNum,callback:function(e){t.$set(t.strategyForm,"saveNum",t._n(e))},expression:"strategyForm.saveNum"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300 "+t._s(t.$t("cluster.detail.backup.backup_help"))+" ")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_account"),prop:"backupAccountName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","allow-create":"",filterable:""},model:{value:t.strategyForm.backupAccountName,callback:function(e){t.$set(t.strategyForm,"backupAccountName",e)},expression:"strategyForm.backupAccountName"}},t._l(t.backupAccounts,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[t._v(" "+t._s(e.name)+"("+t._s(e.bucket)+") ")])})),1),a("div",[a("span",{staticClass:"input-help"},[t._v(t._s(t.$t("cluster.detail.backup.backup_account_help")))])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.status"),prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.strategyForm.status,callback:function(e){t.$set(t.strategyForm,"status",e)},expression:"strategyForm.status"}},[a("el-option",{attrs:{label:t.$t("commons.button.enable"),value:"ENABLE"}},[t._v(t._s(t.$t("commons.button.enable"))+" ")]),a("el-option",{attrs:{label:t.$t("commons.button.disable"),value:"DISABLE"}},[t._v(" "+t._s(t.$t("commons.button.disable"))+" ")])],1)],1),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{disabled:""==t.strategyForm.id||t.submitLoading},on:{click:function(e){return t.backupNow("strategyForm")}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.backup_now"))+" ")]),a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onSubmit("strategyForm")}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.local_recover")))])]),a("el-form",[a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-upload",{staticClass:"upload-demo",attrs:{"on-change":t.onUploadChange,action:"","auto-upload":!1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v(t._s(t.$t("commons.form.file_upload_help")))]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("cluster.detail.backup.local_recover_tips")))])])],1)],1),a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onUploadFile()}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1)],1),a("br"),a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.data,"pagination-config":t.paginationConfig,selects:t.selects},on:{search:t.search,"update:selects":function(e){t.selects=e}},scopedSlots:t._u([{key:"header",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"small",disabled:1!==t.selects.length},on:{click:function(e){return t.restoreByFiles(t.selects[0])}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.recover"))+" ")]),a("el-button",{attrs:{size:"small",disabled:0===t.selects.length},on:{click:function(e){return t.deleteBackupFile()}}},[t._v(" "+t._s(t.$t("commons.button.delete"))+" ")])],1)]},proxy:!0}])},[a("el-table-column",{attrs:{type:"selection",fix:""}}),a("el-table-column",{attrs:{label:t.$t("commons.table.name"),"min-width":"100",prop:"name",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.backup.backup_location"),"min-width":"100",prop:"folder",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1),a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_log"),name:t.$t("cluster.detail.backup.backup_log")}},[a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.logs,loading:t.logLoading}},[a("el-table-column",{attrs:{label:t.$t("commons.table.type"),"min-width":"100",prop:"type",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$t("cluster.detail.backup."+a.type))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.start_time"),"min-width":"100",prop:"startTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.startTime))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.end_time"),"min-width":"100",prop:"endTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["FAILED"===n.status||"SUCCESS"===n.status?a("span",[t._v(t._s(t._f("datetimeFormat")(n.endTime)))]):t._e(),"FAILED"!==n.status&&"SUCCESS"!==n.status?a("span",[t._v("-")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("commons.table.status"),"min-width":"100",prop:"status",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["FAILED"===n.status?a("div",[a("el-popover",{attrs:{placement:"left-start",title:t.$t("cluster.detail.backup.detail"),width:"200",trigger:"click",content:n.message}},[a("div",{attrs:{slot:"reference"},slot:"reference"},[a("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#FA4147"}}),t._v("       "),a("el-link",{attrs:{type:"info"}},[t._v(t._s(t.$t("commons.status.failed")))])],1)])],1):t._e(),"Running"===n.status?a("div",[a("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("commons.status.running"))+" ")]):t._e(),"SUCCESS"===n.status?a("div",[a("span",{staticClass:"iconfont iconduihao",staticStyle:{color:"#32B350"}}),t._v(" "+t._s(t.$t("commons.status.success"))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1)],1)],1)},s=[],c=a("30d5"),o=(a("b1fa"),a("2769"),a("ecf1"),a("f5bd"),a("2e6f"),a("af21"),a("86ca")),r=(a("a5c9"),a("ff66")),i="/api/v1/clusters/backup/files",l="/api/v1/clusters/log",u="/api/v1/clusters/backup/strategy",m="/api/v1/clusters/backupaccounts";function p(t,e,a){var n="".concat(i,"?pageNum=").concat(e,"&pageSize=").concat(a,"&clusterName=").concat(t);return Object(r["c"])(n)}function d(t){var e="".concat(u,"/").concat(t);return Object(r["c"])(e)}function f(t){return Object(r["c"])("".concat(l,"/").concat(t))}function b(t){var e="".concat(u);return Object(r["e"])(e,t)}function g(t){var e="".concat(i,"/backup");return Object(r["e"])(e,t)}function h(t){var e="".concat(i,"/restore");return Object(r["e"])(e,t)}function v(t){var e="".concat(i,"/restore/local");return Object(r["e"])(e,t)}function _(t){return Object(r["c"])("".concat(m,"/").concat(t))}function y(t){return Object(r["b"])("".concat(i,"/").concat(t))}var k=a("0792"),$={name:"ClusterBackup",components:{ComplexTable:o["a"]},data:function(){return{loading:!1,logLoading:!1,submitLoading:!1,clusterName:"",activeName:this.$t("cluster.detail.backup.backup_recover"),data:[],strategyForm:{id:"",cron:1,saveNum:1,backupAccountName:"",status:"",clusterName:""},rules:{cron:[k["a"].NumberRule],saveNum:[k["a"].NumberRule],backupAccountName:[k["a"].RequiredRule],status:[k["a"].RequiredRule]},file:{},paginationConfig:{currentPage:1,pageSize:10,total:0},backupAccounts:[],logs:[],selects:[],timer:{}}},methods:{search:function(){var t=this;if(this.activeName===this.$t("cluster.detail.backup.backup_recover")){var e=this.paginationConfig,a=e.currentPage,n=e.pageSize;p(this.clusterName,a,n).then((function(e){e&&(t.data=e.items,t.paginationConfig.total=e.total)}))}else this.logLoading=!0,f(this.clusterName).then((function(e){e&&(t.logs=e,t.logLoading=!1)})).catch((function(){t.logLoading=!1}))},backupNow:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0;var a={name:"",clusterName:t.clusterName,clusterBackupStrategyID:t.strategyForm.id,folder:""};g(a).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).finally((function(){t.submitLoading=!1}))}))},handleClick:function(){this.search()},onSubmit:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0,t.strategyForm.clusterName=t.clusterName,b(t.strategyForm).then((function(){t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.getBackupStrategy(),t.submitLoading=!1})).catch((function(){t.submitLoading=!1}))}))},getBackupStrategy:function(){var t=this;this.loading=!0,d(this.clusterName).then((function(e){t.loading=!1,t.strategyForm=e})).catch((function(){t.loading=!1}))},onUploadChange:function(t){this.file=t},onUploadFile:function(){var t=this;this.submitLoading=!0;var e=new FormData;e.append("file",this.file.raw),e.append("clusterName",this.clusterName),v(e).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).catch((function(){t.submitLoading=!1}))},restoreByFiles:function(t){var e=this;this.$confirm(this.$t("cluster.detail.backup.restore_message"),this.$t("cluster.detail.backup.CLUSTER_RESTORE"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"info"}).then((function(){h({name:t.name,clusterName:e.clusterName}).then((function(){e.$message({type:"success",message:e.$t("cluster.detail.backup.recover_success")})}))}))},deleteBackupFile:function(t){var e=this;this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){var a=[];if(t)a.push(y(t));else{var n,s=Object(c["a"])(e.selects);try{for(s.s();!(n=s.n()).done;){var o=n.value;a.push(y(o.name))}}catch(r){s.e(r)}finally{s.f()}}Promise.all(a).then((function(){e.search(),e.$message({type:"success",message:e.$t("commons.msg.delete_success")})})).catch((function(){e.search()}))}))},polling:function(){var t=this;this.timer=setInterval((function(){var e,a=!1,n=Object(c["a"])(t.logs);try{for(n.s();!(e=n.n()).done;){var s=e.value;if("Running"===s.status){a=!0;break}}}catch(o){n.e(o)}finally{n.f()}a&&t.search()}),1e4)}},destroyed:function(){clearInterval(this.timer)},created:function(){var t=this;this.clusterName=this.$route.params.name,this.search(),_(this.clusterName).then((function(e){t.backupAccounts=e})),this.getBackupStrategy(),this.polling()}},x=$,S=a("5d22"),C=Object(S["a"])(x,n,s,!1,null,"bc5f2a80",null);e["default"]=C.exports}}]);
//# sourceMappingURL=chunk-6a9a1966.d2e64403.js.map