(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d23156e"],{efb9:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-bottom":"30px"},attrs:{"tab-position":"left"},on:{"tab-click":function(e){return t.handleClick()}},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_recover"),name:t.$t("cluster.detail.backup.backup_recover")}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("el-form",{ref:"strategyForm",attrs:{model:t.strategyForm,rules:t.rules,"label-width":"150px","label-position":"left"}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.backup_strategy")))])]),a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_interval"),prop:"cron"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.cron,callback:function(e){t.$set(t.strategyForm,"cron",t._n(e))},expression:"strategyForm.cron"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.retained_number"),prop:"saveNum"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.saveNum,callback:function(e){t.$set(t.strategyForm,"saveNum",t._n(e))},expression:"strategyForm.saveNum"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300 "+t._s(t.$t("cluster.detail.backup.backup_help"))+" ")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_account"),prop:"backupAccountName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","allow-create":"",filterable:""},model:{value:t.strategyForm.backupAccountName,callback:function(e){t.$set(t.strategyForm,"backupAccountName",e)},expression:"strategyForm.backupAccountName"}},t._l(t.backupAccounts,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[t._v(" "+t._s(e.name)+"("+t._s(e.bucket)+") ")])})),1),a("div",[a("span",{staticClass:"input-help"},[t._v(t._s(t.$t("cluster.detail.backup.backup_account_help")))])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.status"),prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.strategyForm.status,callback:function(e){t.$set(t.strategyForm,"status",e)},expression:"strategyForm.status"}},[a("el-option",{attrs:{label:t.$t("commons.button.enable"),value:"ENABLE"}},[t._v(t._s(t.$t("commons.button.enable"))+" ")]),a("el-option",{attrs:{label:t.$t("commons.button.disable"),value:"DISABLE"}},[t._v(" "+t._s(t.$t("commons.button.disable"))+" ")])],1)],1),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{disabled:""==t.strategyForm.id||t.submitLoading},on:{click:function(e){return t.backupNow("strategyForm")}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.backup_now"))+" ")]),a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onSubmit("strategyForm")}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.local_recover")))])]),a("el-form",[a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-upload",{staticClass:"upload-demo",attrs:{"on-change":t.onUploadChange,action:"","auto-upload":!1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v(t._s(t.$t("commons.form.file_upload_help")))]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.$t("cluster.detail.backup.local_recover_tips")))])])],1)],1),a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onUploadFile()}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1)],1),a("br"),a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.data,"pagination-config":t.paginationConfig,selects:t.selects},on:{search:t.search,"update:selects":function(e){t.selects=e}},scopedSlots:t._u([{key:"header",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"small",disabled:1!==t.selects.length},on:{click:function(e){return t.restoreByFiles(t.selects[0])}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.recover"))+" ")]),a("el-button",{attrs:{size:"small",disabled:0===t.selects.length},on:{click:function(e){return t.deleteBackupFile()}}},[t._v(" "+t._s(t.$t("commons.button.delete"))+" ")])],1)]},proxy:!0}])},[a("el-table-column",{attrs:{type:"selection",fix:""}}),a("el-table-column",{attrs:{label:t.$t("commons.table.name"),"min-width":"100",prop:"name",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.backup.backup_location"),"min-width":"100",prop:"folder",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1),a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_log"),name:t.$t("cluster.detail.backup.backup_log")}},[a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.logs,loading:t.logLoading}},[a("el-table-column",{attrs:{label:t.$t("commons.table.type"),"min-width":"100",prop:"type",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$t("cluster.detail.backup."+a.type))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.start_time"),"min-width":"100",prop:"startTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.startTime))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.end_time"),"min-width":"100",prop:"endTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return["FAILED"===s.status||"SUCCESS"===s.status?a("span",[t._v(t._s(t._f("datetimeFormat")(s.endTime)))]):t._e(),"FAILED"!==s.status&&"SUCCESS"!==s.status?a("span",[t._v("-")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("commons.table.status"),"min-width":"100",prop:"status",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return["FAILED"===s.status?a("div",[a("el-popover",{attrs:{placement:"left-start",title:t.$t("cluster.detail.backup.detail"),width:"200",trigger:"click",content:s.message}},[a("div",{attrs:{slot:"reference"},slot:"reference"},[a("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#FA4147"}}),t._v("       "),a("el-link",{attrs:{type:"info"}},[t._v(t._s(t.$t("commons.status.failed")))])],1)])],1):t._e(),"Running"===s.status?a("div",[a("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("commons.status.running"))+" ")]):t._e(),"SUCCESS"===s.status?a("div",[a("span",{staticClass:"iconfont iconduihao",staticStyle:{color:"#32B350"}}),t._v(" "+t._s(t.$t("commons.status.success"))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1)],1)],1)},c=[],n=a("30d5"),l=(a("b1fa"),a("2769"),a("ecf1"),a("f5bd"),a("2e6f"),a("af21"),a("86ca")),o=(a("a5c9"),a("ff66")),r="/api/v1/clusters/backup/files",i="/api/v1/clusters/log",u="/api/v1/clusters/backup/strategy",m="/api/v1/clusters/backupaccounts";function p(t,e,a){var s="".concat(r,"?pageNum=").concat(e,"&pageSize=").concat(a,"&clusterName=").concat(t);return Object(o["c"])(s)}function d(t){var e="".concat(u,"/").concat(t);return Object(o["c"])(e)}function b(t){return Object(o["c"])("".concat(i,"/").concat(t))}function f(t){var e="".concat(u);return Object(o["e"])(e,t)}function g(t){var e="".concat(r,"/backup");return Object(o["e"])(e,t)}function h(t){var e="".concat(r,"/restore");return Object(o["e"])(e,t)}function v(t){var e="".concat(r,"/restore/local");return Object(o["e"])(e,t)}function _(t){return Object(o["c"])("".concat(m,"/").concat(t))}function k(t){return Object(o["b"])("".concat(r,"/").concat(t))}var y=a("0792"),$={name:"ClusterBackup",components:{ComplexTable:l["a"]},data:function(){return{loading:!1,logLoading:!1,submitLoading:!1,clusterName:"",activeName:this.$t("cluster.detail.backup.backup_recover"),data:[],strategyForm:{id:"",cron:1,saveNum:1,backupAccountName:"",status:"",clusterName:""},rules:{cron:[y["a"].NumberRule],saveNum:[y["a"].NumberRule],backupAccountName:[y["a"].RequiredRule],status:[y["a"].RequiredRule]},file:{},paginationConfig:{currentPage:1,pageSize:10,total:0},backupAccounts:[],logs:[],selects:[],timer:{}}},methods:{search:function(){var t=this;if(this.activeName===this.$t("cluster.detail.backup.backup_recover")){var e=this.paginationConfig,a=e.currentPage,s=e.pageSize;p(this.clusterName,a,s).then((function(e){e&&(t.data=e.items,t.paginationConfig.total=e.total)}))}else this.logLoading=!0,b(this.clusterName).then((function(e){e&&(t.logs=e,t.logLoading=!1)})).catch((function(){t.logLoading=!1}))},backupNow:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0;var a={name:"",clusterName:t.clusterName,clusterBackupStrategyID:t.strategyForm.id,folder:""};g(a).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).finally((function(){t.submitLoading=!1}))}))},handleClick:function(){this.search()},onSubmit:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0,t.strategyForm.clusterName=t.clusterName,f(t.strategyForm).then((function(){t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.getBackupStrategy(),t.submitLoading=!1})).catch((function(){t.submitLoading=!1}))}))},getBackupStrategy:function(){var t=this;this.loading=!0,d(this.clusterName).then((function(e){t.loading=!1,t.strategyForm=e})).catch((function(){t.loading=!1}))},onUploadChange:function(t){this.file=t},onUploadFile:function(){var t=this;this.submitLoading=!0;var e=new FormData;e.append("file",this.file.raw),e.append("clusterName",this.clusterName),v(e).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).catch((function(){t.submitLoading=!1}))},restoreByFiles:function(t){var e=this;this.$confirm(this.$t("cluster.detail.backup.restore_message"),this.$t("cluster.detail.backup.CLUSTER_RESTORE"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"info"}).then((function(){h({name:t.name,clusterName:e.clusterName}).then((function(){e.$message({type:"success",message:e.$t("cluster.detail.backup.recover_success")})}))}))},deleteBackupFile:function(t){var e=this;this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){var a=[];if(t)a.push(k(t));else{var s,c=Object(n["a"])(e.selects);try{for(c.s();!(s=c.n()).done;){var l=s.value;a.push(k(l.name))}}catch(o){c.e(o)}finally{c.f()}}Promise.all(a).then((function(){e.search(),e.$message({type:"success",message:e.$t("commons.msg.delete_success")})})).catch((function(){e.search()}))}))},polling:function(){var t=this;this.timer=setInterval((function(){var e,a=!1,s=Object(n["a"])(t.logs);try{for(s.s();!(e=s.n()).done;){var c=e.value;if("Running"===c.status){a=!0;break}}}catch(l){s.e(l)}finally{s.f()}a&&t.search()}),1e4)}},destroyed:function(){clearInterval(this.timer)},created:function(){var t=this;this.clusterName=this.$route.params.name,this.search(),_(this.clusterName).then((function(e){t.backupAccounts=e})),this.getBackupStrategy(),this.polling()}},N=$,F=a("5d22"),S=Object(F["a"])(N,s,c,!1,null,"bc5f2a80",null);e["default"]=S.exports}}]);
//# sourceMappingURL=chunk-2d23156e.3b20cc28.js.map