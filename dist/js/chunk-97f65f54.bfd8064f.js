(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-97f65f54"],{"396f":function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var r=n("ff66"),c="/api/v1/manifests";function i(){return Object(r["c"])("".concat(c,"/group"))}function o(){return Object(r["c"])("".concat(c,"/active"))}function s(t,e){return Object(r["d"])("".concat(c,"/").concat(t),e)}},"7ea2":function(t,e,n){"use strict";n.d(e,"f",(function(){return s})),n.d(e,"g",(function(){return a})),n.d(e,"b",(function(){return u})),n.d(e,"q",(function(){return l})),n.d(e,"d",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"c",(function(){return h})),n.d(e,"e",(function(){return p})),n.d(e,"m",(function(){return g})),n.d(e,"a",(function(){return v})),n.d(e,"n",(function(){return m})),n.d(e,"r",(function(){return b})),n.d(e,"i",(function(){return _})),n.d(e,"h",(function(){return w})),n.d(e,"j",(function(){return y})),n.d(e,"o",(function(){return V})),n.d(e,"p",(function(){return O})),n.d(e,"k",(function(){return j}));n("a5c9"),n("2769"),n("0756");var r=n("ff66"),c="/api/v1/clusters",i="/api/v1/clusters/logger/{cluster_name}",o="/api/v1/clusters/provisioner/log/{cluster_name}/{log_id}";function s(t){return Object(r["c"])("".concat(c,"/").concat(t))}function a(t){return Object(r["c"])("".concat(c,"/name/").concat(t))}function u(t){return Object(r["c"])("".concat(c,"/existence/").concat(t))}function l(t,e,n){return Object(r["e"])("".concat(c,"/search?pageNum=").concat(t,"&pageSize=").concat(e),n)}function d(t){return Object(r["e"])("".concat(c),t)}function f(t){return Object(r["c"])("".concat(c,"/health/").concat(t))}function h(t){return Object(r["e"])("".concat(c,"/recover/").concat(t),{})}function p(t,e){return Object(r["b"])("".concat(c,"/").concat(t,"?force=").concat(e))}function g(t){return Object(r["e"])("".concat(c,"/import/"),t)}function v(){return Object(r["c"])("".concat(c))}function m(t){return Object(r["e"])("".concat(c,"/init/").concat(t,"/"),{})}function b(t,e){var n={clusterName:t,version:e};return Object(r["e"])("".concat(c,"/upgrade/"),n)}function _(t){return Object(r["c"])("".concat(c,"/status/").concat(t))}function w(t){return Object(r["c"])(i.replace("{cluster_name}",t))}function y(t,e){return Object(r["c"])(o.replace("{cluster_name}",t).replace("{log_id}",e))}function V(t){window.open("/ui/#/logger?clusterName=".concat(t),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function O(t,e){window.open("/ui/#/logger?clusterName=".concat(t,"&logId=").concat(e),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function j(t){return Object(r["c"])("".concat(c,"/secret/").concat(t))}},8639:function(t,e,n){"use strict";var r=n("6c87"),c=n("7cd8"),i=n("9f69"),o=n("e08f"),s=n("7f45"),a=n("952c"),u=n("a4fc"),l=n("1392"),d=n("eb5b"),f=n("4cee"),h=n("d50e"),p=f.UNSUPPORTED_Y,g=[].push,v=Math.min,m=4294967295,b=!h((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));r("split",(function(t,e,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,n){var r=String(o(this)),i=void 0===n?m:n>>>0;if(0===i)return[];if(void 0===t)return[r];if(!c(t))return e.call(r,t,i);var s,a,u,l=[],f=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),h=0,p=new RegExp(t.source,f+"g");while(s=d.call(p,r)){if(a=p.lastIndex,a>h&&(l.push(r.slice(h,s.index)),s.length>1&&s.index<r.length&&g.apply(l,s.slice(1)),u=s[0].length,h=a,l.length>=i))break;p.lastIndex===s.index&&p.lastIndex++}return h===r.length?!u&&p.test("")||l.push(""):l.push(r.slice(h)),l.length>i?l.slice(0,i):l}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e,[function(e,n){var c=o(this),i=void 0==e?void 0:e[t];return void 0!==i?i.call(e,c,n):r.call(String(c),e,n)},function(t,c){var o=n(r,this,t,c,r!==e);if(o.done)return o.value;var d=i(this),f=String(t),h=s(d,RegExp),g=d.unicode,b=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(p?"g":"y"),_=new h(p?"^(?:"+d.source+")":d,b),w=void 0===c?m:c>>>0;if(0===w)return[];if(0===f.length)return null===l(_,f)?[f]:[];var y=0,V=0,O=[];while(V<f.length){_.lastIndex=p?0:V;var j,S=l(_,p?f.slice(V):f);if(null===S||(j=v(u(_.lastIndex+(p?V:0)),f.length))===y)V=a(f,V,g);else{if(O.push(f.slice(y,V)),O.length===w)return O;for(var k=1;k<=S.length-1;k++)if(O.push(S[k]),O.length===w)return O;V=y=j}}return O.push(f.slice(y)),O}]}),!b,p)},8767:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layout-content",{attrs:{header:t.$t("commons.button.upgrade"),"back-to":{name:"ClusterList"}}},[n("el-row",[n("el-col",{attrs:{span:4}},[n("br")]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple-light"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:t.$t("cluster.version"),prop:"version"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},on:{change:t.changeUpgradeVersions},model:{value:t.form.version,callback:function(e){t.$set(t.form,"version",e)},expression:"form.version"}},t._l(t.upgradeVersions,(function(e){return n("el-option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1),0===t.upgradeVersions.length?n("div",[n("span",{staticClass:"input-help"},[t._v(t._s(t.$t("cluster.upgrade.upgrade_help")))])]):t._e()],1),n("el-form-item",[0!==t.newManifest.coreVars.length&&0!==t.oldManifest.coreVars?n("div",[n("table",{staticClass:"myTable",staticStyle:{width:"100%"}},[n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v(t._s(t.$t("commons.table.name")))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.$t("cluster.upgrade.current_version")))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.$t("cluster.upgrade.upgrade_version")))])]),n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Kubernetes")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("kubernetes",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("kubernetes",t.newManifest.coreVars)))])]),t.getVersion("etcd",t.oldManifest.coreVars)!==t.getVersion("etcd",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("ETCD")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("etcd",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("etcd",t.newManifest.coreVars)))])]):t._e(),"docker"==t.currentCluster.spec.runtimeType&&t.getVersion("docker",t.oldManifest.coreVars)!==t.getVersion("docker",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Docker")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("docker",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("docker",t.newManifest.coreVars)))])]):t._e(),"containerd"==t.currentCluster.spec.runtimeType&&t.getVersion("containerd",t.oldManifest.coreVars)!==t.getVersion("containerd",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Containerd")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("containerd",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("containerd",t.newManifest.coreVars)))])]):t._e()])]):t._e()]),n("el-form-item",{staticStyle:{float:"right"}},[n("el-button",{on:{click:function(e){return t.onCancel()}}},[t._v(t._s(t.$t("commons.button.cancel")))]),n("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loadding,expression:"loadding"}],attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("commons.button.ok")))])],1)],1)],1)])],1)],1)},c=[],i=n("30d5"),o=(n("f5bd"),n("2769"),n("8639"),n("e1d4"),n("6afd"),n("be17")),s=n("7ea2"),a=n("396f"),u=n("0792"),l={name:"ClusterUpgrade",props:["name"],components:{LayoutContent:o["a"]},data:function(){return{loadding:!1,form:{clusterName:"",version:""},rules:{version:[u["a"].RequiredRule]},oldManifest:{coreVars:[]},newManifest:{coreVars:[]},upgradeVersions:[],manifestList:[]}},methods:{onSubmit:function(){var t=this;this.$refs["form"].validate((function(e){e&&(t.loadding=!0,Object(s["r"])(t.form.clusterName,t.form.version).then((function(){t.loadding=!1,t.$message({type:"success",message:t.$t("commons.msg.upgrade_start_success")}),t.$router.push({name:"ClusterList"})})).catch((function(){t.loadding=!1})))}))},loadInfo:function(t){var e=this;Object(s["f"])(t).then((function(t){e.currentCluster=t,e.form.clusterName=t.name;var n=t.spec.version,r=n.split("."),c=r[0],o=r[1],s=r[2].split("-ko"),u=Number(s[0]),l=Number(s[1]);e.upgradeVersions=[],Object(a["c"])().then((function(t){var n,r=Object(i["a"])(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;s.clusterManifests.forEach((function(t){e.manifestList.push(t)}))}}catch(_){r.e(_)}finally{r.f()}var a,d=Object(i["a"])(e.manifestList);try{for(d.s();!(a=d.n()).done;){var f=a.value;if(f.isActive){var h=f.name.split("-ko"),p=h[0].split("."),g=Number(h[1]),v=p[0],m=p[1],b=Number(p[2]);c===v&&o===m&&(b>u&&e.upgradeVersions.push(f.name),b===u&&l<g&&e.upgradeVersions.push(f.name))}}}catch(_){d.e(_)}finally{d.f()}}))}))},changeUpgradeVersions:function(){var t,e=Object(i["a"])(this.manifestList);try{for(e.s();!(t=e.n()).done;){var n=t.value;-1!==n.name.indexOf(this.currentCluster.spec.version)&&(this.oldManifest=n),n.name===this.form.version&&(this.newManifest=n)}}catch(r){e.e(r)}finally{e.f()}},getVersion:function(t,e){var n,r=Object(i["a"])(e);try{for(r.s();!(n=r.n()).done;){var c=n.value;if(c.name===t)return c.version}}catch(o){r.e(o)}finally{r.f()}},onCancel:function(){this.$router.push({name:"ClusterList"})}},created:function(){this.loadInfo(this.$route.params.name)}},d=l,f=n("5d22"),h=Object(f["a"])(d,r,c,!1,null,"9d2e1136",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-97f65f54.bfd8064f.js.map