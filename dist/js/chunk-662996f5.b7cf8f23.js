(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-662996f5"],{"00fb":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("complex-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{selects:t.nsSelection,data:t.nameSpaceList,"pagination-config":t.paginationConfig},on:{"update:selects":function(e){t.nsSelection=e}},scopedSlots:t._u([{key:"header",fn:function(){return[a("div",[a("el-button",{attrs:{size:"small",type:"primary",disabled:!0,icon:"el-icon-plus"},on:{click:function(e){return t.create()}}},[t._v(t._s(t.$t("commons.button.create")))]),a("el-button",{attrs:{size:"small",disabled:!0}},[t._v(t._s(t.$t("commons.button.delete")))])],1)]},proxy:!0}])},[a("el-table-column",{attrs:{type:"selection",selectable:t.isInSystemSpace,fix:""}}),a("el-table-column",{attrs:{label:t.$t("commons.table.name"),"min-width":"100",prop:"metadata.name",fix:""}}),a("el-table-column",{attrs:{label:t.$t("commons.table.status"),"min-width":"100",prop:"status.phase",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["Terminating"!==n.status.phase?a("div",[a("span"),t._v(t._s(n.status.phase)+" ")]):t._e(),"Terminating"===n.status.phase?a("div",[a("i",{staticClass:"el-icon-loading"}),t._v("       "),a("span",[t._v(t._s(t.$t("commons.status.terminating"))+" ")])]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("commons.table.create_time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.metadata.creationTimestamp))+" ")]}}])}),a("fu-table-operations",{attrs:{buttons:t.buttons,label:t.$t("commons.table.action"),fix:""}})],1),a("el-dialog",{attrs:{title:t.$t("commons.button.create"),width:"30%","close-on-click-modal":!1,visible:t.dialogCreateVisible},on:{"update:visible":function(e){t.dialogCreateVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{label:t.$t("commons.table.name"),prop:"metadata.name",rules:t.nameRules}},[a("el-input",{staticStyle:{width:"80%"},attrs:{clearable:""},model:{value:t.form.metadata.name,callback:function(e){t.$set(t.form.metadata,"name",e)},expression:"form.metadata.name"}}),a("div",[a("span",{staticClass:"input-help"},[t._v(t._s(t.$t("commons.validate.common_name_help")))])])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogCreateVisible=!1}}},[t._v(t._s(t.$t("commons.button.cancel")))]),a("el-button",{attrs:{type:"primary",disabled:0===t.form.metadata.name.length||t.submitLoading},on:{click:function(e){return t.submitCreate()}}},[t._v(t._s(t.$t("commons.button.ok")))])],1)],1)],1)},s=[],i=a("b85c"),o=(a("4de4"),a("ac1f"),a("841c"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("86ca")),c=a("0600"),l=a("5671"),r=a("0792"),u={name:"ClusterNamespace",components:{ComplexTable:o["a"]},props:["name"],data:function(){var t=this;return{loading:!1,submitLoading:!1,buttons:[{label:this.$t("commons.button.delete"),icon:"el-icon-delete",click:function(e){t.onDelete(e)},disabled:function(e){return!t.isInSystemSpace(e)}}],form:{apiVersion:"v1",kind:"Namespace",metadata:{name:""}},nameRules:[r["a"].CommonNameRule],nsSelection:[],toolList:[],dialogCreateVisible:!1,clusterName:"",selects:[],data:[],ps:[],timer:{},paginationConfig:{currentPage:1,pageSize:10,total:0}}},computed:{nameSpaceList:function(){var t=this,e=this.data.filter((function(e,a){return t.paginationConfig.pageSize*(t.paginationConfig.currentPage-1)<=a&&a<t.paginationConfig.pageSize*t.paginationConfig.currentPage}));return e}},methods:{search:function(){var t=this;this.loading=!0,Object(c["c"])(this.clusterName).then((function(e){t.data=e.items,t.paginationConfig.total=e.items.length,t.loading=!1})).catch((function(){t.loading=!1}))},create:function(){this.dialogCreateVisible=!0},loadTools:function(){var t=this;Object(l["c"])(this.clusterName).then((function(e){t.toolList=e}))},submitCreate:function(){var t=this;this.$refs["form"].validate((function(e){if(!e)return!1;t.submitLoading=!0,Object(c["a"])(t.clusterName,t.form).then((function(){t.$message({type:"success",message:t.$t("commons.msg.create_success")}),t.dialogCreateVisible=!1,t.search(),t.submitLoading=!1})).catch((function(){t.submitLoading=!1,t.dialogCreateVisible=!1}))}))},isInSystemSpace:function(t){var e=["default","kube-public","kube-operator","kube-system","istio-system","kube-node-lease"];return-1===e.indexOf(t.metadata.name)},checkIsEmptyNs:function(t){if(t){var e,a="",n=Object(i["a"])(this.toolList);try{for(n.s();!(e=n.n()).done;){var s=e.value;s.vars["namespace"]===t.metadata.name&&"Waiting"!==s.status&&(a+=s.name+",")}}catch(d){n.e(d)}finally{n.f()}t.toolDetails=a}else{var o,c=Object(i["a"])(this.nsSelection);try{for(c.s();!(o=c.n()).done;){var l,r=o.value,u="",m=Object(i["a"])(this.toolList);try{for(m.s();!(l=m.n()).done;){var p=l.value;p.vars["namespace"]===r.metadata.name&&"Waiting"!==p.status&&(u+=p.name+",")}}catch(d){m.e(d)}finally{m.f()}r.toolDetails=u}}catch(d){c.e(d)}finally{c.f()}}},onDelete:function(t){var e=this;this.checkIsEmptyNs(t),this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){if(e.ps=[],t)t.toolDetails?e.$message({type:"info",message:t.metadata.name+e.$t("cluster.detail.namespace.before_delete")+t.toolDetails}):e.ps.push(Object(c["b"])(e.clusterName,t.metadata.name));else{var a,n=Object(i["a"])(e.nsSelection);try{for(n.s();!(a=n.n()).done;){var s=a.value;s.toolDetails?e.$message({type:"info",message:s.metadata.name+e.$t("cluster.detail.namespace.before_delete")+s.toolDetails}):e.ps.push(Object(c["b"])(e.clusterName,s.metadata.name))}}catch(o){n.e(o)}finally{n.f()}}0!==e.ps.length&&Promise.all(e.ps).then((function(){e.search(),e.$message({type:"success",message:e.$t("commons.msg.op_success")})})).catch((function(){e.search()}))}))},polling:function(){var t=this;this.timer=setInterval((function(){var e,a=!1,n=["Terminating"],s=Object(i["a"])(t.data);try{for(s.s();!(e=s.n()).done;){var o=e.value;if(-1!==n.indexOf(o.status.phase)){a=!0;break}}}catch(l){s.e(l)}finally{s.f()}a&&Object(c["c"])(t.clusterName).then((function(e){t.data=e.items}))}),1e4)}},created:function(){this.clusterName=this.name,this.search(),this.loadTools(),this.polling()},destroyed:function(){clearInterval(this.timer)}},m=u,p=a("2877"),d=Object(p["a"])(m,n,s,!1,null,"51665402",null);e["default"]=d.exports},5671:function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return c})),a.d(e,"d",(function(){return l}));var n=a("ff66"),s="/api/v1/clusters/tool";function i(t){return Object(n["c"])("".concat(s,"/").concat(t))}function o(t,e){return Object(n["e"])("".concat(s,"/enable/").concat(t),e)}function c(t,e){return Object(n["e"])("".concat(s,"/disable/").concat(t),e)}function l(t,e){return Object(n["e"])("".concat(s,"/upgrade/").concat(t),e)}},"57cf":function(t,e,a){},"59f6":function(t,e,a){"use strict";a("57cf")},"71ff":function(t,e,a){t.exports=a.p+"img/data-empty.14cb9add.svg"},bf19:function(t,e,a){"use strict";var n=a("23e7");n({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},f2d8:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"example",staticStyle:{"margin-left":"-20px"}},[n("el-row",[n("el-col",{attrs:{span:7}},[n("el-card",{staticStyle:{"padding-left":"24px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v(t._s(t.$t("cluster.detail.overview.base_info")))])]),n("div",[n("el-col",{attrs:{span:12}},[n("ul",{staticStyle:{"margin-top":"19px"}},[n("span",[t._v(" "+t._s(t.$t("cluster.creation.name")))]),n("span",[t._v(" "+t._s(t.currentCluster.name))])]),n("ul",[n("span",[t._v(" "+t._s(t.$t("cluster.version")))]),n("span",[t._v(" "+t._s(t.currentCluster.spec.version))])]),n("ul",[n("span",[t._v(" "+t._s(t.$t("cluster.creation.arch")))]),n("span",[t._v(" "+t._s(t.currentCluster.spec.architectures))])])]),n("el-col",{attrs:{span:12}},[n("ul",{staticStyle:{"margin-top":"19px"}},[n("span",{staticStyle:{width:"70px"}},[t._v(t._s(t.$t("cluster.creation.network_type")))]),n("span",[t._v(" "+t._s(t.currentCluster.spec.networkType))])]),n("ul",[n("span",{staticStyle:{width:"70px"}},[t._v(t._s(t.$t("cluster.creation.runtime_type")))]),n("span",[t._v(" "+t._s(t.currentCluster.spec.runtimeType))])]),n("ul",[n("span",{staticStyle:{width:"70px"}},[t._v(t._s(t.$t("cluster.detail.overview.source")))]),n("span",[t._v(" "+t._s(t.currentCluster.source))])])])],1)])],1),n("el-col",{attrs:{span:17}},[n("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading_chart,expression:"loading_chart"}],staticClass:"right",staticStyle:{"padding-left":"24px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v(t._s(t.$t("cluster.detail.overview.capacity_info")))])]),n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{staticStyle:{"padding-bottom":"30px"},attrs:{span:8}},[n("div",{attrs:{align:"center"}},[n("el-progress",{attrs:{"stroke-width":20,type:"circle",width:100,percentage:t.cpuUsagePercent,color:"#36B37E"}}),n("br"),n("span",{staticClass:"info-text"},[t._v(t._s(t.$t("cluster.detail.overview.cpu")))])],1)]),n("el-col",{staticStyle:{"padding-bottom":"30px"},attrs:{span:8}},[n("div",{attrs:{align:"center"}},[n("el-progress",{attrs:{"stroke-width":20,type:"circle",width:100,percentage:t.memUsagePercent,color:"#0F73EE"}}),n("br"),n("span",{staticClass:"info-text"},[t._v(t._s(t.$t("cluster.detail.overview.memory")))])],1)]),n("el-col",{staticStyle:{"padding-bottom":"30px"},attrs:{span:8}},[n("div",{attrs:{align:"center"}},[n("el-progress",{attrs:{"stroke-width":20,type:"circle",width:100,percentage:t.podUsagePercent,color:"#5354BB"}}),n("br"),n("span",{staticClass:"info-text"},[t._v(t._s(t.$t("cluster.detail.overview.docker")))])],1)])],1)],1)],1)],1)],1),n("el-tabs",{staticClass:"bottom",model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{name:"Nodes"}},[n("div",{staticClass:"tab-label",attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"iconfont icon-node_normal"}),n("span",[t._v(" Nodes"),n("br"),n("span",{staticClass:"number"},[t._v(t._s(t.nodes.length))])])]),n("node",{attrs:{name:t.name}})],1),n("el-tab-pane",{attrs:{label:"Namespaces",name:"Namespaces"}},[n("div",{staticClass:"tab-label",attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"iconfont icon-namespace_normal"}),n("span",[t._v("Namespaces"),n("br"),n("span",{staticClass:"number"},[t._v(t._s(t.namespaces.length))])])]),n("namespace",{attrs:{name:t.name}})],1),n("el-tab-pane",{attrs:{label:"Deployments",name:"Deployments"}},[n("div",{staticClass:"tab-label",attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"iconfont icon-deployment_normal"}),n("span",[t._v("Deployments"),n("br"),n("span",{staticClass:"number"},[t._v(t._s(t.deployments.length))])])]),n("div",[t.deployments.length>0?n("complex-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.deploymentList,"pagination-config":t.paginationConfig},on:{search:t.search1}},[n("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",[t._v(t._s(a.metadata.name))])]}}],null,!1,2398547072)}),n("el-table-column",{attrs:{label:"ready",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.status.availableReplicas)+"/"+t._s(a.spec.replicas)+" ")]}}],null,!1,51026321)}),n("el-table-column",{attrs:{label:"创建时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.rTime(a.metadata.creationTimestamp))+" ")]}}],null,!1,237920541)})],1):n("div",{staticClass:"empty"},[n("img",{attrs:{src:a("71ff")}}),n("br"),n("span",[t._v("暂无数据~")])])],1)]),n("el-tab-pane",{attrs:{label:"Pods",name:"Pods"}},[n("div",{staticClass:"tab-label",attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"iconfont icon-pod_select"}),n("span",[t._v("Pods"),n("br"),n("span",{staticClass:"number"},[t._v(t._s(t.pods.length))])])]),n("div",[t.pods.length>0?n("complex-table",{attrs:{data:t.podsList,"pagination-config":t.paginationConfig1}},[n("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.metadata.name))])]}}],null,!1,1250752866)}),n("el-table-column",{attrs:{label:"状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(e.row.status.phase))])]}}],null,!1,2329603123)}),n("el-table-column",{attrs:{label:"创建时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.rTime(e.row.metadata.creationTimestamp))+" ")]}}],null,!1,1023988607)})],1):n("div",{staticClass:"empty"},[n("img",{attrs:{src:a("71ff")}}),n("br"),n("span",[t._v("暂无数据~")])])],1)])],1)],1)},s=[],i=(a("4de4"),a("bf19"),a("ac1f"),a("5319"),a("b0c0"),a("159b"),a("a9e3"),a("841c"),a("cacb")),o=a("ebf3"),c=a("0600"),l=a("7ea2"),r=a("3c17"),u=a("00fb"),m=a("86ca"),p={name:"ClusterOverview",components:{node:r["default"],namespace:u["default"],ComplexTable:m["a"]},data:function(){return{loading_chart:!1,loading_xterm:!1,clusterName:"",currentCluster:{name:"",spec:{version:"",architectures:"",networkType:"",kubeProxyMode:"",runtimeType:"",flannelBackend:"",calicoIpv4PoolIpip:""},source:""},namespaces:[],pods:[],nodes:[],deployments:[],containerNumber:0,cpuTotal:0,cpuUsage:0,cpuUsagePercent:0,memTotal:0,memUsage:0,memUsagePercent:0,podLimit:0,podUsagePercent:0,opened:!1,url:"",activeName:"",project:"",name:"",paginationConfig:{currentPage:1,pageSize:10,total:0},paginationConfig1:{currentPage:1,pageSize:10,total:0},loading:!1}},watch:{activeName:function(){}},computed:{deploymentList:function(){var t=this,e=this.deployments.filter((function(e,a){return t.paginationConfig.pageSize*(t.paginationConfig.currentPage-1)<=a&&a<t.paginationConfig.pageSize*t.paginationConfig.currentPage}));return e},podsList:function(){var t=this,e=this.pods.filter((function(e,a){return t.paginationConfig1.pageSize*(t.paginationConfig1.currentPage-1)<=a&&a<t.paginationConfig1.pageSize*t.paginationConfig1.currentPage}));return e}},methods:{rTime:function(t){var e=new Date(new Date(t).getTime()+288e5);return e=e.toJSON(),e=e.substring(0,19).replace("T"," "),e},downloadKubeConfig:function(){window.open("/api/v1/clusters/kubeconfig/".concat(this.clusterName),"_blank")},search1:function(){},search:function(){var t=this;this.loading_chart=!0,this.clusterName=this.$route.params.name,Object(l["e"])(this.clusterName).then((function(e){t.currentCluster=e})),this.loadNameSpaces(),this.loadNodes(),this.loadDeployments()},onOpen:function(){var t=this;this.loading_xterm=!0,this.opened=!0,Object(i["a"])(this.clusterName).then((function(e){t.url="/webkubectl/terminal/?token="+e.token,t.loading_xterm=!1}))},newWindow:function(){var t=this;this.opened=!0,Object(i["a"])(this.clusterName).then((function(e){t.url="/webkubectl/terminal/?token=".concat(e.token),window.open(t.url,"_blank","weight=300,height=200,alwaysRaised=yes,depended=yes")}))},loadNameSpaces:function(){var t=this;Object(c["c"])(this.clusterName).then((function(e){t.namespaces=e.items}))},loadPods:function(){var t=this;Object(i["c"])(this.clusterName).then((function(e){t.pods=e.items,t.pods.forEach((function(e){t.containerNumber=t.containerNumber+e.spec.containers.length})),t.podUsagePercent=Math.round(t.pods.length/t.podLimit*100),t.paginationConfig1.total=e.items.length}))},loadNodes:function(){var t=this;Object(o["d"])(this.clusterName).then((function(e){t.nodes=e.items,t.nodes.forEach((function(e){t.cpuTotal=t.cpuTotal+Number(e.status.capacity.cpu);var a=e.status.capacity.memory.replace("Ki","");t.memTotal=t.memTotal+Number(a),t.podLimit=t.podLimit+Number(e.status.capacity.pods)})),t.loadNodesUsages(),t.loadPods()}))},loadDeployments:function(){var t=this;Object(i["b"])(this.clusterName).then((function(e){t.deployments=e.items,t.paginationConfig.total=e.items.length}))},loadNodesUsages:function(){var t=this;Object(o["g"])(this.clusterName).then((function(e){var a=e.items,n="";a.forEach((function(e){var a="";e.usage.cpu.indexOf("m")>-1&&(a=e.usage.cpu.replace("m",""),n="m"),e.usage.cpu.indexOf("n")>-1&&(a=e.usage.cpu.replace("n",""),n="n"),t.cpuUsage=t.cpuUsage+Number(a);var s=e.usage.memory.replace("Ki","");t.memUsage=t.memUsage+Number(s)})),t.memUsagePercent=Math.round(t.memUsage/t.memTotal*100),"n"===n?(t.cpuUsage=t.cpuUsage/1e9,t.cpuUsagePercent=Math.round(t.cpuUsage/t.cpuTotal*100)):"m"===n&&(t.cpuUsagePercent=Math.round(t.cpuUsage/(1e3*t.cpuTotal)*100)),t.loading_chart=!1}))}},created:function(){this.name=this.$route.params.name},mounted:function(){this.search(),this.activeName="Nodes"}},d=p,f=(a("59f6"),a("2877")),g=Object(f["a"])(d,n,s,!1,null,"ca9ae250",null);e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-662996f5.b7cf8f23.js.map