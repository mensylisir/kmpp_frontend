(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a065218"],{2500:function(t,e,n){},"7ea2":function(t,e,n){"use strict";n.d(e,"f",(function(){return r})),n.d(e,"g",(function(){return s})),n.d(e,"b",(function(){return l})),n.d(e,"q",(function(){return u})),n.d(e,"d",(function(){return d})),n.d(e,"l",(function(){return g})),n.d(e,"c",(function(){return m})),n.d(e,"e",(function(){return h})),n.d(e,"m",(function(){return f})),n.d(e,"a",(function(){return b})),n.d(e,"n",(function(){return p})),n.d(e,"r",(function(){return v})),n.d(e,"i",(function(){return _})),n.d(e,"h",(function(){return k})),n.d(e,"j",(function(){return y})),n.d(e,"o",(function(){return O})),n.d(e,"p",(function(){return j})),n.d(e,"k",(function(){return $}));n("a5c9"),n("2769"),n("0756");var i=n("ff66"),o="/api/v1/clusters",a="/api/v1/clusters/logger/{cluster_name}",c="/api/v1/clusters/provisioner/log/{cluster_name}/{log_id}";function r(t){return Object(i["c"])("".concat(o,"/").concat(t))}function s(t){return Object(i["c"])("".concat(o,"/name/").concat(t))}function l(t){return Object(i["c"])("".concat(o,"/existence/").concat(t))}function u(t,e,n){return Object(i["e"])("".concat(o,"/search?pageNum=").concat(t,"&pageSize=").concat(e),n)}function d(t){return Object(i["e"])("".concat(o),t)}function g(t){return Object(i["c"])("".concat(o,"/health/").concat(t))}function m(t){return Object(i["e"])("".concat(o,"/recover/").concat(t),{})}function h(t,e){return Object(i["b"])("".concat(o,"/").concat(t,"?force=").concat(e))}function f(t){return Object(i["e"])("".concat(o,"/import/"),t)}function b(){return Object(i["c"])("".concat(o))}function p(t){return Object(i["e"])("".concat(o,"/init/").concat(t,"/"),{})}function v(t,e){var n={clusterName:t,version:e};return Object(i["e"])("".concat(o,"/upgrade/"),n)}function _(t){return Object(i["c"])("".concat(o,"/status/").concat(t))}function k(t){return Object(i["c"])(a.replace("{cluster_name}",t))}function y(t,e){return Object(i["c"])(c.replace("{cluster_name}",t).replace("{log_id}",e))}function O(t){window.open("/ui/#/logger?clusterName=".concat(t),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function j(t,e){window.open("/ui/#/logger?clusterName=".concat(t,"&logId=").concat(e),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function $(t){return Object(i["c"])("".concat(o,"/secret/").concat(t))}},b21e:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n("bc44"),n("3979");var i=n("4360"),o=function(t){var e=i["a"].getters&&i["a"].getters.roles;return e.some((function(e){return t.includes(e)}))}},c43c:function(t,e,n){"use strict";n.d(e,"j",(function(){return c})),n.d(e,"a",(function(){return r})),n.d(e,"f",(function(){return s})),n.d(e,"k",(function(){return l})),n.d(e,"e",(function(){return u})),n.d(e,"n",(function(){return d})),n.d(e,"l",(function(){return g})),n.d(e,"i",(function(){return m})),n.d(e,"g",(function(){return h})),n.d(e,"h",(function(){return f})),n.d(e,"b",(function(){return b})),n.d(e,"d",(function(){return p})),n.d(e,"m",(function(){return v})),n.d(e,"c",(function(){return _}));n("a5c9");var i=n("ff66"),o="/api/v1/settings",a="/api/v1/message/setting";function c(t){return Object(i["c"])("".concat(o,"/").concat(t))}function r(t,e){return Object(i["e"])("".concat(o,"/check/").concat(t),e)}function s(t){return Object(i["e"])(o,t)}function l(){return Object(i["c"])("".concat(o,"/registry"))}function u(t){return Object(i["e"])("".concat(o,"/registry"),t)}function d(t,e){return Object(i["d"])("".concat(o,"/registry/").concat(t),e)}function g(t,e,n){return Object(i["e"])("".concat(o,"/registry/search?pageNum=").concat(t,"&pageSize=").concat(e),n)}function m(t){return Object(i["c"])("".concat(o,"/registry/").concat(t))}function h(t){return Object(i["b"])("".concat(o,"/registry/").concat(t))}function f(t){return Object(i["c"])("".concat(a,"/").concat(t))}function b(t,e){return Object(i["e"])("".concat(a,"/check/").concat(t),e)}function p(t,e){return Object(i["e"])("".concat(a,"/").concat(t),e)}function v(t){return Object(i["e"])("/api/v1/ldap/sync",t)}function _(t){return Object(i["e"])("/api/v1/ldap/",t)}},e48e:function(t,e,n){"use strict";n("2500")},fcfb:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layout-content",{attrs:{header:t.$t("cluster.cluster")}},[n("complex-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"local-key":"cluster_columns",selects:t.clusterSelection,"search-config":t.searchConfig,data:t.data,"pagination-config":t.paginationConfig},on:{"update:selects":function(e){t.clusterSelection=e},"selection-change":t.selectChange,search:t.search},scopedSlots:t._u([{key:"header",fn:function(){return[n("el-button-group",[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","PROJECT_MANAGER"],expression:"['ADMIN','PROJECT_MANAGER']"}],attrs:{size:"small"},on:{click:function(e){return t.onCreate()}}},[t._v(" "+t._s(t.$t("commons.button.create"))+" ")]),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","PROJECT_MANAGER"],expression:"['ADMIN','PROJECT_MANAGER']"}],attrs:{size:"small"},on:{click:function(e){return t.onImport()}}},[t._v(" "+t._s(t.$t("commons.button.import"))+" ")]),n("el-button",{attrs:{size:"small",disabled:1!==t.clusterSelection.length||t.isDeleteButtonDisable},on:{click:function(e){return t.onUpgrade()}}},[t._v(" "+t._s(t.$t("commons.button.upgrade"))+" ")]),n("el-button",{attrs:{size:"small",disabled:1!==t.clusterSelection.length||t.isDeleteButtonDisable},on:{click:function(e){return t.onHealthCheck()}}},[t._v(" "+t._s(t.$t("commons.button.check"))+" ")]),n("el-button",{attrs:{size:"small",disabled:t.clusterSelection.length<1||t.isDeleteButtonDisable},on:{click:function(e){return t.onDelete()}}},[t._v(" "+t._s(t.$t("commons.button.delete"))+" ")])],1)]},proxy:!0}])},[n("el-table-column",{attrs:{type:"selection",fix:""}}),n("el-table-column",{attrs:{label:t.$t("commons.table.name"),"min-width":"100",prop:"name",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return["Running"===i.status?n("el-link",{attrs:{type:"info"},on:{click:function(e){return t.goForDetail(i)}}},[t._v(t._s(i.name))]):t._e(),"Running"!==i.status?n("span",[t._v(t._s(i.name))]):t._e()]}}])}),t.isAdmin?n("el-table-column",{attrs:{label:t.$t("cluster.project"),"min-width":"100",prop:"projectName",fix:""}}):t._e(),n("el-table-column",{attrs:{label:t.$t("cluster.version"),"min-width":"80",prop:"spec.version",fix:""}}),n("el-table-column",{attrs:{label:t.$t("cluster.node_size"),"min-width":"50",prop:"nodeSize"}}),n("el-table-column",{attrs:{label:t.$t("commons.table.status"),"min-width":"100",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return["Running"===i.status?n("div",[n("span",{staticClass:"iconfont iconduihao",staticStyle:{color:"#32B350"}}),t._v(" "+t._s(t.$t("commons.status.running"))+" ")]):t._e(),"Failed"===i.status?n("div",[n("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#FA4147"}}),t._v("       "),n("el-link",{attrs:{type:"info"},on:{click:function(e){return t.getStatus(i)}}},[t._v(t._s(t.$t("commons.status.failed")))])],1):t._e(),"Initializing"===i.status?n("div",[n("i",{staticClass:"el-icon-loading"}),t._v("      "),n("el-link",{attrs:{type:"info"},on:{click:function(e){return t.getStatus(i)}}},[t._v(" "+t._s(t.$t("commons.status.initializing")))])],1):t._e(),"Upgrading"===i.status?n("div",[n("i",{staticClass:"el-icon-loading"}),t._v("       "),n("el-link",{attrs:{type:"info"},on:{click:function(e){return t.getStatus(i)}}},[t._v(" "+t._s(t.$t("commons.status.upgrading"))+" ")])],1):t._e(),"Terminating"===i.status&&"bareMetal"===i.provider?n("div",[n("i",{staticClass:"el-icon-loading"}),t._v("       "),n("el-link",{attrs:{type:"info"},on:{click:function(e){return t.getStatus(i)}}},[t._v(t._s(t.$t("commons.status.terminating"))+" ")])],1):t._e(),"Terminating"===i.status&&"bareMetal"!==i.provider?n("div",[n("i",{staticClass:"el-icon-loading"}),t._v("       "),n("span",[t._v(t._s(t.$t("commons.status.terminating"))+" ")])]):t._e(),"Creating"===i.status?n("div",[n("i",{staticClass:"el-icon-loading"}),t._v(t._s(t.$t("commons.status.creating"))+" ")]):t._e()]}}])}),n("el-table-column",{attrs:{width:"150px",label:t.$t("commons.table.create_time")},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(n.createdAt))+" ")]}}])}),n("fu-table-operations",{attrs:{buttons:t.buttons,label:t.$t("commons.table.action"),fix:""}})],1),n("el-dialog",{attrs:{"before-close":t.closeDialogLog,title:t.$t("cluster.condition.condition_detail"),width:"50%",visible:t.dialogLogVisible},on:{close:function(e){return t.search()},"update:visible":function(e){t.dialogLogVisible=e}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.conditionLoading,expression:"conditionLoading"}],staticClass:"dialog",style:{height:t.dialogHeight},attrs:{"element-loading-text":t.$t("cluster.condition.condition_loading"),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 1)"}},[n("el-scrollbar",{staticStyle:{height:"100%"}},[t.log.conditions&&0===t.log.conditions.length?n("span",[t._v(t._s(t._f("errorFormat")(t.log.message)))]):t._e(),n("div",[n("el-steps",{staticStyle:{margin:"0 50px"},attrs:{space:50,direction:"vertical",active:t.activeName}},t._l(t.log.conditions,(function(e){return n("el-step",{key:e.name,attrs:{title:t.$t("cluster.condition."+e.name),description:t._f("errorFormat")(e.message)}},[n("i",{class:t.loadStepIcon(e.status),attrs:{slot:"icon"},slot:"icon"})])})),1)],1)])],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){return t.goForLogs()}}},[t._v(t._s(t.$t("commons.button.log")))]),"Failed"===t.log.phase?n("el-button",{attrs:{size:"small","v-loading":t.retryLoadding},on:{click:function(e){return t.onRetry()}}},[t._v(" "+t._s(t.$t("commons.button.retry"))+" ")]):t._e()],1)]),n("el-dialog",{attrs:{title:t.$t("cluster.delete.delete_cluster"),width:"30%",visible:t.dialogDeleteVisible},on:{"update:visible":function(e){t.dialogDeleteVisible=e}}},[n("el-form",{attrs:{"label-width":"120px"}},[n("el-form-item",{attrs:{label:t.$t("cluster.delete.is_force")}},[n("el-switch",{model:{value:t.isForce,callback:function(e){t.isForce=e},expression:"isForce"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogDeleteVisible=!1}}},[t._v(t._s(t.$t("commons.button.cancel")))]),n("el-button",{attrs:{size:"small","v-loading":t.deleteLoadding},on:{click:function(e){return t.submitDelete()}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1),n("el-dialog",{attrs:{title:t.$t("cluster.health_check.health_check"),width:"50%",visible:t.dialogCheckVisible},on:{"update:visible":function(e){t.dialogCheckVisible=e}}},[n("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"center"}},[t.isRecover?t._e():n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.checkLoading,expression:"checkLoading"}],staticStyle:{width:"90%"},attrs:{data:t.checkData.hooks,border:""}},[n("el-table-column",{attrs:{prop:"name",label:t.$t("commons.table.name")}}),n("el-table-column",{attrs:{prop:"level",label:t.$t("cluster.health_check.level")}}),n("el-table-column",{attrs:{prop:"msg",label:t.$t("cluster.health_check.message")}})],1)],1),n("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"center"}},[t.isRecover?n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.checkLoading,expression:"checkLoading"}],staticStyle:{width:"90%"},attrs:{data:t.recoverItems,border:""}},[n("el-table-column",{attrs:{prop:"hookName",label:t.$t("commons.table.name")}}),n("el-table-column",{attrs:{prop:"name",label:t.$t("cluster.health_check.method")}}),n("el-table-column",{attrs:{prop:"result",label:t.$t("cluster.health_check.result")}}),n("el-table-column",{attrs:{prop:"msg",label:t.$t("cluster.health_check.message")}})],1):t._e()],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["error"==t.checkData.level?n("el-button",{attrs:{size:"small"},on:{click:function(e){return t.onRecover()}}},[t._v(" "+t._s(t.$t("cluster.health_check.recover"))+" ")]):t._e()],1)])],1)},o=[],a=n("30d5"),c=(n("f5bd"),n("b1fa"),n("2e6f"),n("af21"),n("2769"),n("ecf1"),n("be17")),r=n("86ca"),s=n("7ea2"),l=n("c43c"),u=n("b21e"),d={name:"ClusterList",components:{ComplexTable:r["a"],LayoutContent:c["a"]},data:function(){var t=this;return{buttons:[{label:this.$t("commons.button.upgrade"),icon:"el-icon-upload2",click:function(e){t.onUpgrade(e)},disabled:function(t){return"Running"!==t.status}},{label:this.$t("commons.button.check"),icon:"el-icon-data-line",click:function(e){t.onHealthCheck(e)},disabled:function(t){return"Running"!==t.status&&"Failed"!==t.status}},{label:this.$t("commons.button.delete"),icon:"el-icon-delete",click:function(e){t.onDelete(e)},disabled:function(t){return"Running"!==t.status&&"Failed"!==t.status}}],isAdmin:Object(u["a"])("ADMIN"),paginationConfig:{currentPage:1,pageSize:10,total:0},clusterName:"",currentCluster:{},clusterSelection:[],data:[],dialogCheckVisible:!1,checkLoading:!0,isRecover:!1,recoverItems:[],checkData:{},dialogLogVisible:!1,dialogHeight:"400px",log:{phase:"",prePhase:"",message:"",conditions:[]},activeName:1,retryLoadding:!1,conditionLoading:!1,isForce:!1,deleteLoadding:!1,dialogDeleteVisible:!1,isDeleteButtonDisable:!1,deleteName:"",searchConfig:{quickPlaceholder:this.$t("commons.search.quickSearch"),components:[{field:"name",label:this.$t("commons.table.name"),component:"FuComplexInput",defaultOperator:"eq"},{field:"created_at",label:this.$t("commons.table.create_time"),component:"FuComplexDateTime",valueFormat:"yyyy-MM-dd HH:mm:ss"}]},loading:!1,timer:{},timer2:{}}},methods:{search:function(t){var e=this;this.loading=!0;var n=this.paginationConfig,i=n.currentPage,o=n.pageSize;Object(s["q"])(i,o,t).then((function(t){e.loading=!1,e.data=t.items,e.paginationConfig.total=t.total}))},searchForPolling:function(t){var e=this,n=this.paginationConfig,i=n.currentPage,o=n.pageSize;Object(s["q"])(i,o,t).then((function(t){e.data=t.items,e.paginationConfig.total=t.total}))},onCreate:function(){this.$router.push({name:"ClusterCreate"})},onImport:function(){this.$router.push({name:"ClusterImport"})},onUpgrade:function(t){t||(t=this.clusterSelection[0]),this.$router.push({name:"ClusterUpgrade",params:{name:t.name}})},goForDetail:function(t){var e=this;Object(l["k"])().then((function(n){var i=null===n.items?[]:n.items,o=!1,c=!1,r=!1;switch(t.spec.architectures){case"amd64":var s,l=Object(a["a"])(i);try{for(l.s();!(s=l.n()).done;){var u=s.value;if("x86_64"===u.architecture){o=!0;break}}}catch(p){l.e(p)}finally{l.f()}break;case"arm64":var d,g=Object(a["a"])(i);try{for(g.s();!(d=g.n()).done;){var m=d.value;if("aarch64"===m.architecture){o=!0;break}}}catch(p){g.e(p)}finally{g.f()}break;case"all":var h,f=Object(a["a"])(i);try{for(f.s();!(h=f.n()).done;){var b=h.value;"x86_64"!==b.architecture?"aarch64"!==b.architecture||(r=!0):c=!0}}catch(p){f.e(p)}finally{f.f()}o=c&&r;break}o?e.$router.push({name:"ClusterOverview",params:{project:t.projectName,name:t.name}}):e.$message({type:"info",message:e.$t("cluster.creation.repo_err")})}))},selectChange:function(){var t=!0;if(0!==this.clusterSelection.length){var e,n=Object(a["a"])(this.clusterSelection);try{for(n.s();!(e=n.n()).done;){var i=e.value;if("Running"!==i.status&&"Failed"!==i.status){t=!1;break}}}catch(o){n.e(o)}finally{n.f()}this.isDeleteButtonDisable=!t}else this.isDeleteButtonDisable=!0},onDelete:function(t){this.isForce=!1,this.dialogDeleteVisible=!0,t&&(this.deleteName=t.name)},submitDelete:function(){var t=this;this.deleteLoadding=!0,this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){var e=[];if(t.deleteName)e.push(Object(s["e"])(t.deleteName,t.isForce));else{var n,i=Object(a["a"])(t.clusterSelection);try{for(i.s();!(n=i.n()).done;){var o=n.value;e.push(Object(s["e"])(o.name,t.isForce))}}catch(c){i.e(c)}finally{i.f()}}Promise.all(e).then((function(){t.search(),t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.dialogDeleteVisible=!1,t.deleteLoadding=!1})).catch((function(){t.search(),t.dialogDeleteVisible=!1,t.deleteLoadding=!1}))}))},onHealthCheck:function(t){var e=this;t||(t=this.clusterSelection[0]),this.currentCluster=t,this.dialogCheckVisible=!0,this.checkLoading=!0,this.isRecover=!1,this.recoverItems=[],Object(s["l"])(this.currentCluster.name).then((function(t){e.checkData=t,e.checkLoading=!1}))},onRecover:function(){var t=this;this.checkLoading=!0,this.isRecover=!0,this.checkData={hooks:[],level:""},Object(s["c"])(this.currentCluster.name).then((function(e){t.recoverItems=e,t.checkLoading=!1}))},getStatus:function(t){var e=this;this.dialogHeight="Terminating"===t.status?"100px":"400px",this.currentCluster=t,this.dialogLogVisible=!0,this.clusterName=t.name,this.dialogPolling(),Object(s["i"])(t.name).then((function(t){e.log=t,e.activeName=e.log.conditions.length+1}))},loadStepIcon:function(t){switch(t){case"True":return"el-icon-check";case"False":return"el-icon-close";case"Unknown":return"el-icon-loading"}},goForLogs:function(){Object(s["o"])(this.clusterName)},onRetry:function(){var t=this;switch(this.retryLoadding=!0,this.log.prePhase){case"Upgrading":Object(s["r"])(this.clusterName,this.currentCluster.spec.upgradeVersion).then((function(){t.retryLoadding=!1,t.log.phase="Upgrading"}));break;case"Initializing":Object(s["n"])(this.clusterName).then((function(){t.retryLoadding=!1,t.log.phase="Initializing"}));break;case"Terminating":Object(s["e"])(this.clusterName,!0).then((function(){t.retryLoadding=!1,t.log.phase="Terminating"}));break;case"Creating":Object(s["n"])(this.clusterName).then((function(){t.retryLoadding=!1,t.dialogLogVisible=!1,t.log.phase="Creating"}));break;case"Waiting":Object(s["n"])(this.clusterName).then((function(){t.retryLoadding=!1,t.log.phase="Waiting"}));break}},closeDialogLog:function(){clearInterval(this.timer2),this.dialogLogVisible=!1},dialogPolling:function(){var t=this;this.timer2=setInterval((function(){0===t.log.conditions.length&&"Failed"!==t.currentCluster.status||(t.conditionLoading=!1),"Running"!==t.log.phase&&"Failed"!==t.log.phase&&Object(s["i"])(t.clusterName).then((function(e){t.activeName=t.log.conditions.length+1,t.log.conditions=e.conditions,t.log.phase!==e.phase&&(t.log.phase=e.phase),t.log.prePhase!==e.prePhase&&(t.log.prePhase=e.prePhase)})).catch((function(){t.dialogLogVisible=!1,clearInterval(t.timer2)}))}),3e3)},polling:function(){var t=this;this.timer=setInterval((function(){var e,n=!1,i=["Initializing","Terminating","Creating","Waiting","Upgrading"],o=Object(a["a"])(t.data);try{for(o.s();!(e=o.n()).done;){var c=e.value;if(-1!==i.indexOf(c.status)){n=!0;break}}}catch(r){o.e(r)}finally{o.f()}n&&t.searchForPolling()}),1e4)}},mounted:function(){this.search(),this.polling()},destroyed:function(){clearInterval(this.timer),clearInterval(this.timer2)}},g=d,m=(n("e48e"),n("5d22")),h=Object(m["a"])(g,i,o,!1,null,"a1cb4e38",null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-4a065218.badd2c6d.js.map