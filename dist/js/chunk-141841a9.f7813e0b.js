(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-141841a9"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"1a55":function(t,e,a){"use strict";a("648b")},"648b":function(t,e,a){t.exports={theme:"#5354bb"}},"7ea2":function(t,e,a){"use strict";a.d(e,"e",(function(){return s})),a.d(e,"f",(function(){return l})),a.d(e,"a",(function(){return i})),a.d(e,"p",(function(){return u})),a.d(e,"c",(function(){return m})),a.d(e,"k",(function(){return p})),a.d(e,"b",(function(){return d})),a.d(e,"d",(function(){return f})),a.d(e,"l",(function(){return b})),a.d(e,"m",(function(){return g})),a.d(e,"q",(function(){return h})),a.d(e,"h",(function(){return v})),a.d(e,"g",(function(){return _})),a.d(e,"i",(function(){return k})),a.d(e,"n",(function(){return y})),a.d(e,"o",(function(){return $})),a.d(e,"j",(function(){return x}));a("99af"),a("ac1f"),a("5319");var n=a("ff66"),r="/api/v1/clusters",c="/api/v1/clusters/logger/{cluster_name}",o="/api/v1/clusters/provisioner/log/{cluster_name}/{log_id}";function s(t){return Object(n["c"])("".concat(r,"/").concat(t))}function l(t){return Object(n["c"])("".concat(r,"/name/").concat(t))}function i(t){return Object(n["c"])("".concat(r,"/existence/").concat(t))}function u(t,e,a){return Object(n["e"])("".concat(r,"/search?pageNum=").concat(t,"&pageSize=").concat(e),a)}function m(t){return Object(n["e"])("".concat(r),t)}function p(t){return Object(n["c"])("".concat(r,"/health/").concat(t))}function d(t){return Object(n["e"])("".concat(r,"/recover/").concat(t),{})}function f(t,e){return Object(n["b"])("".concat(r,"/").concat(t,"?force=").concat(e))}function b(t){return Object(n["e"])("".concat(r,"/import/"),t)}function g(t){return Object(n["e"])("".concat(r,"/init/").concat(t,"/"),{})}function h(t,e){var a={clusterName:t,version:e};return Object(n["e"])("".concat(r,"/upgrade/"),a)}function v(t){return Object(n["c"])("".concat(r,"/status/").concat(t))}function _(t){return Object(n["c"])(c.replace("{cluster_name}",t))}function k(t,e){return Object(n["c"])(o.replace("{cluster_name}",t).replace("{log_id}",e))}function y(t){window.open("/ui/#/logger?clusterName=".concat(t),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function $(t,e){window.open("/ui/#/logger?clusterName=".concat(t,"&logId=").concat(e),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function x(t){return Object(n["c"])("".concat(r,"/secret/").concat(t))}},"841c":function(t,e,a){"use strict";var n=a("d784"),r=a("825a"),c=a("1d80"),o=a("129f"),s=a("577e"),l=a("14c3");n("search",(function(t,e,a){return[function(e){var a=c(this),n=void 0==e?void 0:e[t];return void 0!==n?n.call(e,a):new RegExp(e)[t](s(a))},function(t){var n=r(this),c=s(t),i=a(e,n,c);if(i.done)return i.value;var u=n.lastIndex;o(u,0)||(n.lastIndex=0);var m=l(n,c);return o(n.lastIndex,u)||(n.lastIndex=u),null===m?-1:m.index}]}))},"86ca":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"complex-table"},[t.$slots.header||t.header?a("div",{staticClass:"complex-table__header"},[t._t("header",(function(){return[t._v(t._s(t.header))]})),t.$slots.toolbar||t.searchConfig?a("div",{staticClass:"complex-table__toolbar"},[a("div",[t._t("toolbar")],2),a("fu-search-bar",t._b({on:{exec:t.search},scopedSlots:t._u([{key:"complex",fn:function(){return[t._t("complex")]},proxy:!0}],null,!0)},"fu-search-bar",t.searchConfig,!1),[t._t("buttons"),a("fu-table-column-select",{attrs:{columns:t.columns}})],2)],1):t._e()],2):t._e(),a("div",{staticClass:"complex-table__body"},[a("fu-table",t._g(t._b({attrs:{columns:t.columns,"local-key":t.localKey},on:{"selection-change":t.handleSelectionChange}},"fu-table",t.$attrs,!1),t.$listeners),[t._t("default")],2)],1),t.$slots.pagination||t.paginationConfig?a("div",{staticClass:"complex-table__pagination"},[t._t("pagination",(function(){return[a("fu-table-pagination",t._b({attrs:{"current-page":t.paginationConfig.currentPage,"page-size":t.paginationConfig.pageSize},on:{"update:currentPage":function(e){return t.$set(t.paginationConfig,"currentPage",e)},"update:current-page":function(e){return t.$set(t.paginationConfig,"currentPage",e)},"update:pageSize":function(e){return t.$set(t.paginationConfig,"pageSize",e)},"update:page-size":function(e){return t.$set(t.paginationConfig,"pageSize",e)},change:t.search}},"fu-table-pagination",t.paginationConfig,!1))]}))],2):t._e()])},r=[],c={name:"ComplexTable",props:{columns:{type:Array,default:function(){return[]}},localKey:String,header:String,searchConfig:Object,paginationConfig:Object,selects:Array},data:function(){return{condition:{}}},methods:{search:function(t,e){t&&(this.condition=t),this.$emit("search",this.condition,e)},handleSelectionChange:function(t){this.$emit("update:selects",t)}}},o=c,s=(a("1a55"),a("2877")),l=Object(s["a"])(o,n,r,!1,null,null,null);e["a"]=l.exports},a15b:function(t,e,a){"use strict";var n=a("23e7"),r=a("44ad"),c=a("fc6a"),o=a("a640"),s=[].join,l=r!=Object,i=o("join",",");n({target:"Array",proto:!0,forced:l||!i},{join:function(t){return s.call(c(this),void 0===t?",":t)}})},b85c:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");var n=a("06c5");function r(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=Object(n["a"])(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var r=0,c=function(){};return{s:c,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==a["return"]||a["return"]()}finally{if(l)throw o}}}}},c584:function(t,e,a){"use strict";a("d2b9")},d2b9:function(t,e,a){},efb9:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-top":"24px"}},[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-bottom":"30px"},attrs:{"tab-position":"left"},on:{"tab-click":function(e){return t.handleClick()}},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_recover"),name:t.$t("cluster.detail.backup.backup_recover")}},[a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:12}},[a("el-form",{ref:"strategyForm",attrs:{model:t.strategyForm,rules:t.rules,"label-width":"150px","label-position":"left"}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.backup_strategy")))])]),a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_interval"),prop:"cron"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.cron,callback:function(e){t.$set(t.strategyForm,"cron",t._n(e))},expression:"strategyForm.cron"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.retained_number"),prop:"saveNum"}},[a("el-input-number",{staticStyle:{width:"100%"},attrs:{step:1,"step-strictly":"",max:300,clearable:""},model:{value:t.strategyForm.saveNum,callback:function(e){t.$set(t.strategyForm,"saveNum",t._n(e))},expression:"strategyForm.saveNum"}}),a("div",[a("span",{staticClass:"input-help"},[t._v("1 - 300 "+t._s(t.$t("cluster.detail.backup.backup_help"))+" ")])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.backup_account"),prop:"backupAccountName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","allow-create":"",filterable:""},model:{value:t.strategyForm.backupAccountName,callback:function(e){t.$set(t.strategyForm,"backupAccountName",e)},expression:"strategyForm.backupAccountName"}},[a("el-option",{staticClass:"label",attrs:{disabled:"",label:"选择备份账号",value:"label"}}),t.backupAccounts.length>0?a("div",t._l(t.backupAccounts,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[t._v(" "+t._s(e.name)+"("+t._s(e.bucket)+") ")])})),1):a("div",{staticClass:"empty"},[t._v("暂无数据")]),a("div",{staticClass:"created",on:{click:t.goCreated}},[t._v(" + 新建备份账号 ")])],1),a("div",[a("span",{staticClass:"input-help"},[t._v(t._s(t.$t("cluster.detail.backup.backup_account_help")))])])],1),a("el-form-item",{attrs:{label:t.$t("cluster.detail.backup.status"),prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.strategyForm.status,callback:function(e){t.$set(t.strategyForm,"status",e)},expression:"strategyForm.status"}},[a("el-option",{attrs:{label:t.$t("commons.button.enable"),value:"ENABLE"}},[t._v(t._s(t.$t("commons.button.enable"))+" ")]),a("el-option",{attrs:{label:t.$t("commons.button.disable"),value:"DISABLE"}},[t._v(" "+t._s(t.$t("commons.button.disable"))+" ")])],1)],1),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{attrs:{disabled:""==t.strategyForm.id||t.submitLoading},on:{click:function(e){return t.backupNow("strategyForm")}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.backup_now"))+" ")]),a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onSubmit("strategyForm")}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-card",{staticStyle:{height:"450px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.$t("cluster.detail.backup.local_recover")))])]),a("el-form",[a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-upload",{staticClass:"upload-demo",attrs:{"on-change":t.onUploadChange,action:"","auto-upload":!1,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v(" "+t._s(t.$t("commons.form.file_upload_help"))+" ")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" "+t._s(t.$t("cluster.detail.backup.local_recover_tips"))+" ")])])],1)],1),a("el-form-item",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary",disabled:t.submitLoading},on:{click:function(e){return t.onUploadFile()}}},[t._v(" "+t._s(t.$t("commons.button.submit"))+" ")])],1)],1)],1)],1)],1)],1),a("br"),a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.data,"pagination-config":t.paginationConfig,selects:t.selects},on:{search:t.search,"update:selects":function(e){t.selects=e}},scopedSlots:t._u([{key:"header",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"small",disabled:1!==t.selects.length},on:{click:function(e){return t.restoreByFiles(t.selects[0])}}},[t._v(" "+t._s(t.$t("cluster.detail.backup.recover"))+" ")]),a("el-button",{attrs:{size:"small",disabled:0===t.selects.length},on:{click:function(e){return t.deleteBackupFile()}}},[t._v(" "+t._s(t.$t("commons.button.delete"))+" ")])],1)]},proxy:!0}])},[a("el-table-column",{attrs:{type:"selection",fix:""}}),a("el-table-column",{attrs:{label:t.$t("commons.table.name"),"min-width":"100",prop:"name",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.backup.backup_location"),"min-width":"100",prop:"folder",fix:""}}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1),a("el-tab-pane",{attrs:{label:t.$t("cluster.detail.backup.backup_log"),name:t.$t("cluster.detail.backup.backup_log")}},[a("complex-table",{attrs:{header:t.$t("cluster.detail.backup.backup_list"),data:t.logs,loading:t.logLoading}},[a("el-table-column",{attrs:{label:t.$t("commons.table.type"),"min-width":"100",prop:"type",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$t("cluster.detail.backup."+a.type))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.start_time"),"min-width":"100",prop:"startTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.startTime))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.security.end_time"),"min-width":"100",prop:"endTime",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["FAILED"===n.status||"SUCCESS"===n.status?a("span",[t._v(t._s(t._f("datetimeFormat")(n.endTime)))]):t._e(),"FAILED"!==n.status&&"SUCCESS"!==n.status?a("span",[t._v("-")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("commons.table.status"),"min-width":"100",prop:"status",fix:""},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return["FAILED"===n.status?a("div",[a("el-popover",{attrs:{placement:"left-start",title:t.$t("cluster.detail.backup.detail"),width:"200",trigger:"click",content:n.message}},[a("div",{attrs:{slot:"reference"},slot:"reference"},[a("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#fa4147"}}),t._v("       "),a("el-link",{attrs:{type:"info"}},[t._v(t._s(t.$t("commons.status.failed")))])],1)])],1):t._e(),"Running"===n.status?a("div",[a("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("commons.status.running"))+" ")]):t._e(),"SUCCESS"===n.status?a("div",[a("span",{staticClass:"iconfont iconduihao",staticStyle:{color:"#32b350"}}),t._v(" "+t._s(t.$t("commons.status.success"))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("cluster.detail.log.time")},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("datetimeFormat")(a.createdAt))+" ")]}}])})],1)],1)],1),a("Created",{attrs:{dialogFormVisible:t.dialogFormVisible,clusterName:t.clusterName},on:{cancel:t.cancel}})],1)},r=[],c=a("b85c"),o=(a("d3b7"),a("ac1f"),a("841c"),a("b0c0"),a("3ca3"),a("ddb0"),a("86ca")),s=(a("99af"),a("ff66")),l="/api/v1/clusters/backup/files",i="/api/v1/clusters/log",u="/api/v1/clusters/backup/strategy",m="/api/v1/clusters/backupaccounts";function p(t,e,a){var n="".concat(l,"?pageNum=").concat(e,"&pageSize=").concat(a,"&clusterName=").concat(t);return Object(s["c"])(n)}function d(t){var e="".concat(u,"/").concat(t);return Object(s["c"])(e)}function f(t){return Object(s["c"])("".concat(i,"/").concat(t))}function b(t){var e="".concat(u);return Object(s["e"])(e,t)}function g(t){var e="".concat(l,"/backup");return Object(s["e"])(e,t)}function h(t){var e="".concat(l,"/restore");return Object(s["e"])(e,t)}function v(t){var e="".concat(l,"/restore/local");return Object(s["e"])(e,t)}function _(t){return Object(s["c"])("".concat(m,"/").concat(t))}function k(t){return Object(s["b"])("".concat(l,"/").concat(t))}var y=a("0792"),$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dialog"},[a("el-dialog",{attrs:{title:"新建备份账号",visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:function(e){return t.onCancel()}}},[a("el-form",{ref:"createForm",attrs:{"label-position":"left",rules:t.rules,model:t.form,"label-width":"160px"}},[a("el-form-item",{attrs:{label:t.$t("commons.table.name"),prop:"name"}},[a("el-input",{on:{blur:t.getBucketOption},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),a("div",[a("span",{staticClass:"input-help"},[t._v(t._s(t.$t("commons.validate.name_help")))])])],1),a("el-form-item",{attrs:{label:t.$t("commons.table.type"),required:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:t.$t("commons.validate.select")},on:{change:t.getBucketOption},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.typeOptions,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label,disabled:t.disabled}})})),1)],1),"OSS"===t.form.type||"MINIO"===t.form.type?a("el-form-item",{attrs:{label:"AccessKey",prop:"credentialVars.accessKey"}},[a("el-input",{on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["accessKey"],callback:function(e){t.$set(t.form.credentialVars,"accessKey",e)},expression:"form.credentialVars['accessKey']"}})],1):t._e(),"OSS"===t.form.type||"MINIO"===t.form.type?a("el-form-item",{attrs:{label:"SecretKey",prop:"credentialVars.secretKey"}},[a("el-input",{attrs:{type:"password"},on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["secretKey"],callback:function(e){t.$set(t.form.credentialVars,"secretKey",e)},expression:"form.credentialVars['secretKey']"}})],1):t._e(),"AZURE"===t.form.type?a("el-form-item",{attrs:{label:t.$t("backup_account.table.accountName"),prop:"credentialVars.accountName"}},[a("el-input",{on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["accountName"],callback:function(e){t.$set(t.form.credentialVars,"accountName",e)},expression:"form.credentialVars['accountName']"}})],1):t._e(),"AZURE"===t.form.type?a("el-form-item",{attrs:{label:t.$t("backup_account.table.accountKey"),prop:"credentialVars.accountKey"}},[a("el-input",{attrs:{type:"password"},on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["accountKey"],callback:function(e){t.$set(t.form.credentialVars,"accountKey",e)},expression:"form.credentialVars['accountKey']"}})],1):t._e(),"MINIO"===t.form.type?a("el-form-item",{attrs:{label:t.$t("backup_account.table.region"),prop:"credentialVars.region"}},[a("el-input",{on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["region"],callback:function(e){t.$set(t.form.credentialVars,"region",e)},expression:"form.credentialVars['region']"}})],1):t._e(),"SFTP"!==t.form.type?a("el-form-item",{attrs:{label:t.$t("backup_account.table.endpoint"),prop:"credentialVars.endpoint"}},[a("el-input",{on:{blur:t.getBucketOption},model:{value:t.form.credentialVars["endpoint"],callback:function(e){t.$set(t.form.credentialVars,"endpoint",e)},expression:"form.credentialVars['endpoint']"}})],1):t._e(),"SFTP"!==t.form.type?a("el-form-item",{attrs:{label:t.$t("backup_account.table.bucket"),prop:"bucket"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:t.$t("commons.validate.select"),disabled:!t.bucketShow},model:{value:t.form.bucket,callback:function(e){t.$set(t.form,"bucket",e)},expression:"form.bucket"}},t._l(t.buckets,(function(t){return a("el-option",{key:t,attrs:{value:t}})})),1)],1):t._e(),"SFTP"===t.form.type?a("div",[a("el-form-item",{attrs:{label:t.$t("backup_account.table.address"),prop:"credentialVars.address"}},[a("el-input",{attrs:{placeholder:"172.16.10.100"},model:{value:t.form.credentialVars["address"],callback:function(e){t.$set(t.form.credentialVars,"address",e)},expression:"form.credentialVars['address']"}})],1),a("el-form-item",{attrs:{label:t.$t("backup_account.table.port"),prop:"credentialVars.port"}},[a("el-input-number",{attrs:{min:0,max:65535},model:{value:t.form.credentialVars["port"],callback:function(e){t.$set(t.form.credentialVars,"port",e)},expression:"form.credentialVars['port']"}})],1),a("el-form-item",{attrs:{label:t.$t("backup_account.table.username"),prop:"credentialVars.username"}},[a("el-input",{model:{value:t.form.credentialVars["username"],callback:function(e){t.$set(t.form.credentialVars,"username",e)},expression:"form.credentialVars['username']"}})],1),a("el-form-item",{attrs:{label:t.$t("backup_account.table.password"),prop:"credentialVars.password"}},[a("el-input",{attrs:{type:"password"},model:{value:t.form.credentialVars["password"],callback:function(e){t.$set(t.form.credentialVars,"password",e)},expression:"form.credentialVars['password']"}})],1),a("el-form-item",{attrs:{label:t.$t("backup_account.table.path"),prop:"bucket"}},[a("el-input",{model:{value:t.form.bucket,callback:function(e){t.$set(t.form,"bucket",e)},expression:"form.bucket"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:t.$t("host.cluster_auth"),prop:"clusters"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","reserve-keyword":""},model:{value:t.form.clusters,callback:function(e){t.$set(t.form,"clusters",e)},expression:"form.clusters"}},[a("el-option",{attrs:{label:t.clusterName,value:t.clusterName}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.onCancel()}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},x=[],S=(a("a15b"),"/api/v1/backupaccounts");function C(t){return Object(s["e"])("".concat(S),t)}function w(t){return Object(s["e"])("".concat(S,"/buckets"),t)}var N=a("7ea2"),O={name:"RegistryCreate",components:{},props:["dialogFormVisible","clusterName"],data:function(){return{form:{projects:["kubeoperator"],clusters:[],name:"",type:"MINIO",bucket:"",credentialVars:{}},rules:{name:[y["a"].NameRule],bucket:[y["a"].RequiredRule],credentialVars:{accessKey:[y["a"].RequiredRule],secretKey:[y["a"].RequiredRule],accountName:[y["a"].RequiredRule],accountKey:[y["a"].RequiredRule],region:[y["a"].RequiredRule],endpoint:[y["a"].RequiredRule],port:[y["a"].RequiredRule],username:[y["a"].RequiredRule],address:[y["a"].RequiredRule],password:[y["a"].RequiredRule]}},typeOptions:[{value:"MINIO"}],formLabelWidth:"120px",buckets:[],loading:!1,projects:[],clusters:[],visible:!1}},watch:{dialogFormVisible:function(t){this.visible=t||!1}},computed:{bucketShow:function(){var t=!!(this.form.name&&this.form.type&&this.form.credentialVars.region&&this.form.credentialVars.endpoint);return console.log(t),t}},methods:{getBucketOption:function(){this.bucketShow&&this.getBuckets()},onSubmit:function(){var t=this;this.$refs.createForm.validate((function(e){if(!e)return!1;t.loading=!0,C({bucket:t.form.bucket,credentialVars:t.form.credentialVars,name:t.form.name,type:t.form.type,projects:t.form.projects,clusters:t.form.clusters}).then((function(){t.loading=!1,t.$message({type:"success",message:t.$t("commons.msg.create_success")}),t.onCancel("submit")})).finally((function(){t.loading=!1}))}))},onCancel:function(t){this.$refs.createForm.resetFields(),"submit"===t&&this.$emit("cancel",!0),this.$emit("cancel")},getClusters:function(){var t=this;if(this.clusters=[],this.form.clusters=[],0!==this.form.projects.length){var e=this.form.projects.join(",");Object(N["f"])(e).then((function(e){t.clusters=[];var a,n=Object(c["a"])(e);try{for(n.s();!(a=n.n()).done;){var r=a.value;t.clusters.push(r.name)}}catch(o){n.e(o)}finally{n.f()}}))}},getBuckets:function(){var t=this;this.loading=!0,console.log(this.form.credentialVars),w({name:this.form.name,type:this.form.type,credentialVars:this.form.credentialVars}).then((function(e){t.loading=!1,t.buckets=e})).finally((function(){t.loading=!1}))}},created:function(){this.form.clusters.push(this.clusterName)}},V=O,j=a("2877"),F=Object(j["a"])(V,$,x,!1,null,"08efdb83",null),R=F.exports,A={name:"ClusterBackup",components:{ComplexTable:o["a"],Created:R},data:function(){return{loading:!1,logLoading:!1,submitLoading:!1,clusterName:"",activeName:this.$t("cluster.detail.backup.backup_recover"),data:[],strategyForm:{id:"",cron:1,saveNum:1,backupAccountName:"",status:"",clusterName:""},rules:{cron:[y["a"].NumberRule],saveNum:[y["a"].NumberRule],backupAccountName:[y["a"].RequiredRule],status:[y["a"].RequiredRule]},file:{},paginationConfig:{currentPage:1,pageSize:10,total:0},backupAccounts:[],logs:[],selects:[],timer:{},dialogFormVisible:!1}},methods:{goCreated:function(){this.dialogFormVisible=!0},cancel:function(t){var e=this;t&&_(this.clusterName).then((function(t){e.backupAccounts=t})),this.dialogFormVisible=!1},search:function(){var t=this;if(this.activeName===this.$t("cluster.detail.backup.backup_recover")){var e=this.paginationConfig,a=e.currentPage,n=e.pageSize;p(this.clusterName,a,n).then((function(e){e&&(t.data=e.items,t.paginationConfig.total=e.total)}))}else this.logLoading=!0,f(this.clusterName).then((function(e){e&&(t.logs=e,t.logLoading=!1)})).catch((function(){t.logLoading=!1}))},backupNow:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0;var a={name:"",clusterName:t.clusterName,clusterBackupStrategyID:t.strategyForm.id,folder:""};g(a).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).finally((function(){t.submitLoading=!1}))}))},handleClick:function(){this.search()},onSubmit:function(){var t=this;this.$refs["strategyForm"].validate((function(e){if(!e)return!1;t.submitLoading=!0,t.strategyForm.clusterName=t.clusterName,b(t.strategyForm).then((function(){t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.getBackupStrategy(),t.submitLoading=!1})).catch((function(){t.submitLoading=!1}))}))},getBackupStrategy:function(){var t=this;this.loading=!0,d(this.clusterName).then((function(e){t.loading=!1,t.strategyForm=e})).catch((function(){t.loading=!1}))},onUploadChange:function(t){this.file=t},onUploadFile:function(){var t=this;this.submitLoading=!0;var e=new FormData;e.append("file",this.file.raw),e.append("clusterName",this.clusterName),v(e).then((function(){t.submitLoading=!1,t.$message({type:"success",message:t.$t("cluster.detail.backup.backup_start")})})).catch((function(){t.submitLoading=!1}))},restoreByFiles:function(t){var e=this;this.$confirm(this.$t("cluster.detail.backup.restore_message"),this.$t("cluster.detail.backup.CLUSTER_RESTORE"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"info"}).then((function(){h({name:t.name,clusterName:e.clusterName}).then((function(){e.$message({type:"success",message:e.$t("cluster.detail.backup.recover_success")})}))}))},deleteBackupFile:function(t){var e=this;this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){var a=[];if(t)a.push(k(t));else{var n,r=Object(c["a"])(e.selects);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push(k(o.name))}}catch(s){r.e(s)}finally{r.f()}}Promise.all(a).then((function(){e.search(),e.$message({type:"success",message:e.$t("commons.msg.delete_success")})})).catch((function(){e.search()}))}))},polling:function(){var t=this;this.timer=setInterval((function(){var e,a=!1,n=Object(c["a"])(t.logs);try{for(n.s();!(e=n.n()).done;){var r=e.value;if("Running"===r.status){a=!0;break}}}catch(o){n.e(o)}finally{n.f()}a&&t.search()}),1e4)}},destroyed:function(){clearInterval(this.timer)},created:function(){var t=this;this.clusterName=this.$route.params.name,this.search(),_(this.clusterName).then((function(e){t.backupAccounts=e})),this.getBackupStrategy(),this.polling()}},B=A,L=(a("c584"),Object(j["a"])(B,n,r,!1,null,"0b7b8f65",null));e["default"]=L.exports}}]);
//# sourceMappingURL=chunk-141841a9.f7813e0b.js.map