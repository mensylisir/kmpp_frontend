(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-222eccc1"],{"0600":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l}));n("2769"),n("0756");var a=n("ff66"),o="/proxy/kubernetes/{cluster_name}/{resource_url}",s="api/v1/namespaces",i="api/v1/namespaces/{namespace}";function r(e){var t=o.replace("{cluster_name}",e).replace("{resource_url}",s);return Object(a["c"])(t)}function c(e,t){var n=o.replace("{cluster_name}",e).replace("{resource_url}",s);return Object(a["e"])(n,t)}function l(e,t){var n=o.replace("{cluster_name}",e).replace("{resource_url}",i).replace("{namespace}",t);return Object(a["b"])(n)}},"1a55":function(e,t,n){"use strict";n("2a6b")},2621:function(e,t,n){"use strict";var a=n("e450"),o=n("4582"),s=n("4b3a"),i=n("104f"),r=[].join,c=o!=Object,l=i("join",",");a({target:"Array",proto:!0,forced:c||!l},{join:function(e){return r.call(s(this),void 0===e?",":e)}})},"2a6b":function(e,t,n){e.exports={theme:"#5354bb"}},"30d5":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("79fd"),n("45af"),n("b1fa"),n("1ec5"),n("2e6f"),n("af21");var a=n("ec81");function o(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Object(a["a"])(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0,s=function(){};return{s:s,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,i=e},f:function(){try{r||null==n["return"]||n["return"]()}finally{if(c)throw i}}}}},"3c17":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[""===e.provider?n("el-alert",{attrs:{title:e.$t("cluster.detail.node.operator_help"),type:"info"}}):e._e(),n("complex-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-top":"20px"},attrs:{selects:e.selects,data:e.data,"pagination-config":e.paginationConfig},on:{"update:selects":function(t){e.selects=t},search:e.search},scopedSlots:e._u([{key:"header",fn:function(){return[n("el-button-group",[n("el-button",{attrs:{size:"small",disabled:""===e.provider||e.buttonDisabled()},on:{click:function(t){return e.create()}}},[e._v(e._s(e.$t("commons.button.create")))]),n("el-button",{attrs:{size:"small",disabled:e.selects.length<1||""===e.provider||e.buttonDisabled()},on:{click:function(t){return e.onDelete()}}},[e._v(e._s(e.$t("commons.button.delete")))]),n("el-button",{attrs:{size:"small",disabled:e.selects.length<1},on:{click:function(t){return e.onCordon("cordon")}}},[e._v(e._s(e.$t("commons.button.cordon")))]),n("el-button",{attrs:{size:"small",disabled:e.selects.length<1},on:{click:function(t){return e.onCordon("uncordon")}}},[e._v(e._s(e.$t("commons.button.active")))])],1)]},proxy:!0}])},[n("el-table-column",{attrs:{type:"selection",fix:""}}),n("el-table-column",{attrs:{label:e.$t("commons.table.name"),"show-overflow-tooltip":"","min-width":"100",prop:"name",fix:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[-1!==a.status.indexOf("Running")?n("el-link",{attrs:{type:"info"},on:{click:function(t){return e.getDetailInfo(a)}}},[e._v(e._s(a.name))]):e._e(),-1===a.status.indexOf("Running")?n("span",[e._v(e._s(a.name))]):e._e()]}}])}),n("el-table-column",{attrs:{label:"IP",width:"120px",fix:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(e.getInternalIp(n)))]}}])}),n("el-table-column",{attrs:{label:e.$t("cluster.version"),width:"100px",fix:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(e.getVersion(n)))]}}])}),n("el-table-column",{attrs:{label:"Roles","show-overflow-tooltip":"","min-width":"100",prop:"roles",fix:""}}),n("el-table-column",{staticClass:"ko-status",attrs:{label:e.$t("commons.table.status"),prop:"status",fix:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[-1!==a.status.indexOf("Terminating")&&"bareMetal"!==e.currentCluster.provider?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v("      "+e._s(e.$t("commons.status.terminating"))+" ")]):e._e(),-1!==a.status.indexOf("Terminating")&&"bareMetal"===e.currentCluster.provider?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v("       "),n("el-link",{attrs:{type:"info"},on:{click:function(t){return e.getStatus(a)}}},[e._v(e._s(e.$t("commons.status.terminating"))+" ")])],1):e._e(),"Failed"===a.status?n("div",[n("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#FA4147"}}),e._v("       "),n("el-link",{attrs:{type:"info"},on:{click:function(t){return e.getStatus(a)}}},[e._v(e._s(e.$t("commons.status.failed")))])],1):e._e(),"Lost"===a.status?n("div",[n("span",{staticClass:"iconfont iconerror",staticStyle:{color:"#FA4147"}}),e._v("       "+e._s(e.$t("commons.status.lost"))+" ")]):e._e(),"Initializing"===a.status?n("div",[n("i",{staticClass:"el-icon-loading"}),e._v("      "),n("el-link",{attrs:{type:"info"},on:{click:function(t){return e.getStatus(a)}}},[e._v(" "+e._s(e.$t("commons.status.initializing")))])],1):e._e(),-1!==a.status.indexOf("Running")?n("div",[n("span",{staticClass:"iconfont iconduihao",staticStyle:{color:"#32B350"}}),e._v(" "+e._s(e.$t("commons.status.running"))+" ")]):e._e(),-1!==a.status.indexOf("SchedulingDisabled")?n("div",[n("span",{staticClass:"iconfont icondiable",staticStyle:{color:"#FA4147"}}),e._v(" "+e._s(e.$t("commons.status.disable_scheduling"))+" ")]):e._e(),"Creating"===a.status?n("div",[n("span",{staticClass:"loading",staticStyle:{color:"#32B350"}}),e._v(" "+e._s(e.$t("commons.status.creating"))+" ")]):e._e(),"NotReady"===a.status?n("div",[n("span",{staticClass:"iconfont iconping",staticStyle:{color:"#FA4147"}}),e._v(" "+e._s(e.$t("commons.status.not_ready"))+" ")]):e._e()]}}])}),n("el-table-column",{attrs:{label:e.$t("commons.table.create_time")},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(e._f("datetimeFormat")(n.createdAt))+" ")]}}])}),n("fu-table-operations",{attrs:{buttons:e.buttons,label:e.$t("commons.table.action"),fix:""}})],1),n("el-dialog",{attrs:{title:e.$t("commons.button.create"),width:"30%",visible:e.dialogCreateVisible},on:{"update:visible":function(t){e.dialogCreateVisible=t}}},[n("el-form",{ref:"createForm",attrs:{"label-position":"left",model:e.createForm,rules:e.rules,"label-width":"110px"}},["plan"===e.provider?n("el-form-item",{attrs:{prop:"increase",label:e.$t("cluster.detail.node.increment")}},[n("el-input-number",{staticStyle:{width:"80%"},attrs:{clearable:""},model:{value:e.createForm.increase,callback:function(t){e.$set(e.createForm,"increase",e._n(t))},expression:"createForm.increase"}})],1):e._e(),"bareMetal"===e.provider?n("el-form-item",{attrs:{prop:"hosts",label:e.$t("cluster.detail.node.host")}},[n("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",clearable:""},model:{value:e.createForm.hosts,callback:function(t){e.$set(e.createForm,"hosts",t)},expression:"createForm.hosts"}},e._l(e.hosts,(function(t){return n("el-option",{key:t.name,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1):e._e(),"disable"!==e.supportGpu||e.gpuExist?e._e():n("el-form-item",{attrs:{prop:"supportGpu",label:e.$t("cluster.creation.support_gpu")}},[n("el-switch",{staticStyle:{width:"80%"},attrs:{"active-value":"enable","inactive-value":"diable"},model:{value:e.createForm.supportGpu,callback:function(t){e.$set(e.createForm,"supportGpu",t)},expression:"createForm.supportGpu"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogCreateVisible=!1}}},[e._v(e._s(e.$t("commons.button.cancel")))]),n("el-button",{attrs:{type:"primary",disabled:""===e.provider||e.submitLoading},on:{click:function(t){return e.submitCreate()}}},[e._v(e._s(e.$t("commons.button.ok")))])],1)],1),n("el-dialog",{attrs:{title:e.$t("cluster.detail.node.node_detail"),width:"50%",visible:e.dialogDetailVisible},on:{"update:visible":function(t){e.dialogDetailVisible=t}}},[n("div",{staticClass:"dialog"},[n("el-scrollbar",{staticStyle:{height:"100%"}},[n("div",{staticStyle:{"text-align":"center"}},[n("span",[e._v(e._s(e.$t("cluster.detail.node.base_infomation")))]),n("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"center"}},[n("table",{staticClass:"myTable",staticStyle:{width:"90%"}},[n("tbody",[n("tr",[n("td",[e._v("Name")]),n("td",[e._v(e._s(e.detaiInfo.metadata.name))])]),n("tr",[n("td",[e._v("Kernel Version")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.kernelVersion))])]),n("tr",[n("td",[e._v("OS Image")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.osImage))])]),n("tr",[n("td",[e._v("Container Runtime Version")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.containerRuntimeVersion))])]),n("tr",[n("td",[e._v("Kubelet Version")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.kubeletVersion))])]),n("tr",[n("td",[e._v("KubeProxy Version")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.kubeProxyVersion))])]),n("tr",[n("td",[e._v("Operating System")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.operatingSystem))])]),n("tr",[n("td",[e._v("Architecture")]),n("td",[e._v(e._s(e.detaiInfo.status.nodeInfo.architecture))])])])])]),n("br"),n("span",{staticStyle:{"margin-top":"30px"}},[e._v(e._s(e.$t("cluster.detail.node.label")))]),n("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"center"}},[n("table",{staticClass:"myTable",staticStyle:{width:"90%"}},[n("tbody",e._l(e.detaiInfo.metadata.labels,(function(t,a){return n("tr",{key:a},[n("td",[e._v(e._s(a))]),n("td",[e._v(e._s(t))])])})),0)])]),n("br"),n("span",{staticStyle:{"margin-top":"30px"}},[e._v(e._s(e.$t("cluster.detail.node.status")))]),n("div",{staticStyle:{"margin-top":"15px"},attrs:{align:"center"}},[n("el-table",{staticStyle:{width:"90%"},attrs:{data:e.detaiInfo.status.conditions,border:""}},[n("el-table-column",{attrs:{prop:"type","min-width":"80","show-overflow-tooltip":"",label:"Type"}}),n("el-table-column",{attrs:{prop:"status","min-width":"50",label:"Status"}}),n("el-table-column",{attrs:{prop:"lastTransitionTime","min-width":"100",label:"Time"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(" "+e._s(e._f("datetimeFormat")(n.lastTransitionTime))+" ")]}}])}),n("el-table-column",{attrs:{prop:"reason","show-overflow-tooltip":"","min-width":"100",label:"Reason"}}),n("el-table-column",{attrs:{prop:"message","show-overflow-tooltip":"","min-width":"100",label:"Message"}})],1)],1)]),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogDetailVisible=!1}}},[e._v(e._s(e.$t("commons.button.cancel")))])],1)])],1)]),n("el-dialog",{attrs:{"before-close":e.closeDialogLog,title:e.$t("cluster.condition.condition_detail"),width:"50%",visible:e.dialogLogVisible},on:{close:function(t){return e.search()},"update:visible":function(t){e.dialogLogVisible=t}}},[n("div",{staticClass:"dialog",staticStyle:{height:"100px"}},[n("el-scrollbar",{staticStyle:{height:"100%"}},[n("div",[n("el-steps",{staticStyle:{margin:"0 50px"},attrs:{space:50,direction:"vertical",active:e.activeName}},[n("el-step",{attrs:{title:e.log.name,description:e._f("errorFormat")(e.log.message)}},[n("i",{class:e.log.icon,attrs:{slot:"icon"},slot:"icon"})])],1)],1)])],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(t){return e.goForLogs()}}},[e._v(e._s(e.$t("commons.button.log")))]),"Failed"===e.log.phase?n("el-button",{attrs:{size:"small","v-loading":e.retryLoadding},on:{click:function(t){return e.onRetry()}}},[e._v(" "+e._s(e.$t("commons.button.retry"))+" ")]):e._e()],1)]),n("el-dialog",{attrs:{title:e.$t("cluster.detail.node.cordon"),width:"50%",visible:e.dialogCordonVisible},on:{"update:visible":function(t){e.dialogCordonVisible=t}}},[n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-form",{attrs:{"label-width":"120px"}},[n("el-form-item",{attrs:{label:e.$t("cluster.detail.node.mode")}},[n("el-radio",{attrs:{label:"safe"},model:{value:e.modeSelect,callback:function(t){e.modeSelect=t},expression:"modeSelect"}},[e._v(e._s(e.$t("cluster.detail.node.safe")))]),n("div",[n("span",{staticClass:"input-help"},[e._v(e._s(e.$t("cluster.detail.node.safe_cordon_help")))])]),n("el-radio",{attrs:{label:"force"},model:{value:e.modeSelect,callback:function(t){e.modeSelect=t},expression:"modeSelect"}},[e._v(e._s(e.$t("cluster.detail.node.force")))]),n("div",[n("span",{staticClass:"input-help"},[e._v(e._s(e.$t("cluster.detail.node.force_drain_help1")))]),n("div",[n("span",{staticClass:"input-help",staticStyle:{"margin-left":"20px"}},[e._v(e._s(e.$t("cluster.detail.node.force_drain_help2")))])]),n("div",[n("span",{staticClass:"input-help",staticStyle:{"margin-left":"20px"}},[e._v(e._s(e.$t("cluster.detail.node.force_drain_help3")))])])])],1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogCordonVisible=!1}}},[e._v(e._s(e.$t("commons.button.cancel")))]),n("el-button",{attrs:{type:"primary",disabled:e.submitLoading},on:{click:function(t){return e.submitCordon(!0)}}},[e._v(e._s(e.$t("commons.button.submit")))])],1)],1)],1)},o=[],s=n("30d5"),i=(n("6afd"),n("f5bd"),n("2769"),n("ecf1"),n("b1fa"),n("2e6f"),n("af21"),n("2621"),n("86ca")),r=n("0600"),c=n("ebf3"),l=(n("a5c9"),n("ff66")),u=function(e,t){return"/api/v1/projects/".concat(e,"/clusters/").concat(t,"/resources")};function d(e,t,n){return Object(l["c"])("".concat(u(e,t),"?resourceType=").concat(n))}var f=n("7ea2"),m=n("cacb"),p=n("0792"),b={name:"ClusterNode",components:{ComplexTable:i["a"]},data:function(){var e=this;return{loading:!1,submitLoading:!1,buttons:[{label:this.$t("commons.button.delete"),icon:"el-icon-delete",click:function(t){e.onDelete(t)},disabled:function(t){return""===e.provider||e.buttonDisabled(t)}}],paginationConfig:{currentPage:1,pageSize:5,total:0},dialogCreateVisible:!1,gpuExist:!1,clusterName:"",selects:[],data:[],createForm:{hosts:[],nodes:[],increase:1,supportGpu:""},supportGpu:"",deleteForm:{nodes:""},rules:{increase:[p["a"].NumberRule],hosts:[p["a"].RequiredRule]},dialogDetailVisible:!1,detaiInfo:{metadata:{name:"",labels:[],labelsItem:[]},status:{nodeInfo:{},conditions:{}},spec:{}},activeName:1,dialogLogVisible:!1,log:{name:"",phase:"",prePhase:"",message:""},retryLoadding:!1,currentNode:{},currentCluster:{},hosts:[],provider:null,dialogCordonVisible:!1,modeSelect:"safe",namespaces:[],timer:{}}},methods:{search:function(){var e=this;this.loading=!0;var t=this.paginationConfig,n=t.currentPage,a=t.pageSize;Object(c["f"])(this.clusterName,n,a).then((function(t){e.loading=!1,e.data=t.items,e.data.forEach((function(t){t.roles=e.getNodeRoles(t),t.info.spec["unschedulable"]&&(t.status+=", SchedulingDisabled")})),e.paginationConfig.total=t.total})).catch((function(){e.loading=!1})),Object(r["c"])(this.clusterName).then((function(t){var n,a=Object(s["a"])(t.items);try{for(a.s();!(n=a.n()).done;){var o=n.value;"gpu-operator-resources"===o.metadata.name&&(e.gpuExist=!0)}}catch(i){a.e(i)}finally{a.f()}e.namespaces=t.items,e.loading=!1})).catch((function(){e.loading=!1}))},searchForPolling:function(){var e=this,t=this.paginationConfig,n=t.currentPage,a=t.pageSize;Object(c["f"])(this.clusterName,n,a).then((function(t){e.data=t.items,e.data.forEach((function(t){t.roles=e.getNodeRoles(t),t.info.spec["unschedulable"]&&(t.status+=", SchedulingDisabled")})),e.paginationConfig.total=t.total}))},buttonDisabled:function(e){var t=["Initializing","Terminating","Terminating, SchedulingDisabled","Creating"];if(e)return-1!==t.indexOf(e.status);var n,a=Object(s["a"])(this.selects);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(-1!==t.indexOf(o.status))return!0}}catch(i){a.e(i)}finally{a.f()}return!1},create:function(){var e=this;this.dialogCreateVisible=!0,"bareMetal"===this.provider&&d(this.projectName,this.clusterName,"HOST").then((function(t){e.hosts=[],t.items.forEach((function(t){"Running"===t.status&&""===t.clusterId&&e.hosts.push(t)}))}))},getDetailInfo:function(e){this.detaiInfo=e.info,this.dialogDetailVisible=!0},submitCreate:function(){var e=this;this.$refs["createForm"].validate((function(t){if(!t)return!1;e.submitLoading=!0,e.createForm.operation="create",Object(c["h"])(e.clusterName,e.createForm).then((function(){e.$message({type:"success",message:e.$t("commons.msg.create_success")}),e.resetForm("createForm"),e.dialogCreateVisible=!1,e.search(),e.submitLoading=!1})).catch((function(){e.submitLoading=!1,e.resetForm("createForm"),e.dialogCreateVisible=!1}))}))},resetForm:function(e){this.$refs[e].resetFields()},onDelete:function(e){var t=this;if(e){if(-1!==e.roles.indexOf("master"))return void this.$message({type:"info",message:this.$t("cluster.detail.node.is_master_node")})}else{var n,a=Object(s["a"])(this.selects);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(-1!==o.roles.indexOf("master"))return void this.$message({type:"info",message:this.$t("cluster.detail.node.is_master_node")})}}catch(i){a.e(i)}finally{a.f()}}this.$confirm(this.$t("commons.confirm_message.delete"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){var n={operation:"delete",nodes:[]};if(n.operation="delete",e)n.nodes.push(e.name);else{var a,o=Object(s["a"])(t.selects);try{for(o.s();!(a=o.n()).done;){var r=a.value;n.nodes.push(r.name)}}catch(i){o.e(i)}finally{o.f()}}Object(c["h"])(t.clusterName,n).then((function(){t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.selects=[],t.search()})).catch((function(){t.search(),t.selects=[]}))}))},onCordon:function(e){var t=this;if("cordon"===e){var n,a=Object(s["a"])(this.selects);try{for(a.s();!(n=a.n()).done;){var o=n.value;if("Running"!==o.status)return void this.$message({type:"info",message:this.$t("cluster.detail.node.existing_cordoned")})}}catch(l){a.e(l)}finally{a.f()}this.dialogCordonVisible=!0}else{var i,r=Object(s["a"])(this.selects);try{for(r.s();!(i=r.n()).done;){var c=i.value;if("Running, SchedulingDisabled"!==c.status)return void this.$message({type:"info",message:this.$t("cluster.detail.node.existing_actived")})}}catch(l){r.e(l)}finally{r.f()}this.$confirm(this.$t("commons.confirm_message.uncordon"),this.$t("commons.message_box.prompt"),{confirmButtonText:this.$t("commons.button.confirm"),cancelButtonText:this.$t("commons.button.cancel"),type:"warning"}).then((function(){t.submitCordon(!1)}))}},submitCordon:function(e){var t=this;this.submitLoading=!0;var n,a={spec:{unschedulable:e}},o=[],i=Object(s["a"])(this.selects);try{var r=function(){var s=n.value;o.push(Object(c["a"])(t.clusterName,s.name,a).then((function(){"force"===t.modeSelect&&e&&Object(m["c"])(t.clusterName).then((function(e){t.bacthDeletePod(e.items,s.name)}))})))};for(i.s();!(n=i.n()).done;)r()}catch(l){i.e(l)}finally{i.f()}Promise.all(o).then((function(){t.search(),t.dialogCordonVisible=!1,t.submitLoading=!1,t.$message({type:"success",message:t.$t("commons.msg.op_success")}),t.selects=[]})).catch((function(){t.submitLoading=!1,t.dialogCordonVisible=!1,t.search(),t.selects=[]}))},bacthDeletePod:function(e,t){var n,a=this,o=[],i=Object(s["a"])(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.spec.nodeName===t&&"daemonset"!==r.metadata.ownerReferences.kind){var l={apiVersion:"policy/v1beta1",kind:"Eviction",metadata:{name:r.metadata.name,namespace:r.metadata.namespace,creationTimestamp:null},deleteOptions:{}};o.push(Object(c["b"])(this.clusterName,r.metadata.namespace,r.metadata.name,l))}}}catch(u){i.e(u)}finally{i.f()}Promise.all(o).then((function(){a.search(),a.$message({type:"success",message:a.$t("cluster.detail.node.drain_success")})})).catch((function(){a.search()}))},getInternalIp:function(e){return e.ip?e.ip:"N/a"},getVersion:function(e){var t="N/A";return-1!==e.status.indexOf("Running")&&(t=e.info.status.nodeInfo.kubeletVersion),t},getNodeRoles:function(e){var t=[];if("Running"===e.status)for(var n in e.info.metadata.labels)if(n)switch(n){case"node-role.kubernetes.io/master":t.push("master");break;case"node-role.kubernetes.io/etcd":t.push("etcd");break;case"node-role.kubernetes.io/worker":t.push("worker");break;case"node-role.kubernetes.io/control-plane":t.push("control-plane");break}return t.join(",")},getCluster:function(){var e=this;Object(f["e"])(this.clusterName).then((function(t){e.currentCluster=t,e.provider=e.currentCluster.spec.provider,e.supportGpu=e.currentCluster.spec.supportGpu}))},getStatus:function(e){var t=this;this.currentNode=e,this.dialogLogVisible=!0,this.dialogPolling(),Object(c["c"])(this.clusterName,this.currentNode.name).then((function(e){t.log.icon="Failed"===e.status?"el-icon-close":"el-icon-loading";var n="Failed"===e.status?e.pre_status:e.status;t.log.name="Initializing"===n?t.$t("cluster.detail.node.node_expand"):t.$t("cluster.detail.node.node_shrink"),t.log.phase=e.status,t.log.message=e.message}))},goForLogs:function(){Object(f["n"])(this.clusterName)},onRetry:function(){var e=this;switch(this.retryLoadding=!0,this.currentNode.pre_status){case"Initializing":Object(c["i"])(this.clusterName,this.currentNode.name).then((function(){e.retryLoadding=!1,e.log.phase="Initializing"}));break;case"Terminating":var t={operation:"delete",nodes:[]};t.operation="delete",t.nodes.push(this.currentNode.name),Object(c["h"])(this.clusterName,t).then((function(){e.retryLoadding=!1,e.log.phase="Terminating"}));break}this.log.icon="el-icon-loading"},closeDialogLog:function(){clearInterval(this.timer2),this.dialogLogVisible=!1},dialogPolling:function(){var e=this;this.timer2=setInterval((function(){"Running"!==e.log.phase&&"Failed"!==e.log.phase&&"Failed"!==e.log.phase&&Object(c["c"])(e.clusterName,e.currentNode.name).then((function(t){switch(t.status!==e.log.phase&&(e.log.prePhase=e.log.phase,e.log.phase=t.status),e.log.status=t.status,e.log.message=t.message,t.status){case"Running":e.log.icon="el-icon-check";break;case"Failed":case"NotReady":e.log.icon="el-icon-close";break;default:e.log.icon="el-icon-loading";break}})).catch((function(){e.dialogLogVisible=!1,clearInterval(e.timer2)}))}),3e3)},polling:function(){var e=this;this.timer=setInterval((function(){var t,n=!1,a=["Initializing","Terminating","Terminating, SchedulingDisabled","Creating"],o=Object(s["a"])(e.data);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(-1!==a.indexOf(i.status)){n=!0;break}}}catch(r){o.e(r)}finally{o.f()}n&&e.searchForPolling()}),1e4)}},created:function(){this.clusterName=this.$route.params.name,this.projectName=this.$route.params.project,this.getCluster(),this.search(),this.polling()},destroyed:function(){clearInterval(this.timer)}},g=b,h=(n("66e4"),n("5d22")),v=Object(h["a"])(g,a,o,!1,null,"668fc5a8",null);t["default"]=v.exports},"66e4":function(e,t,n){"use strict";n("9e34")},"78d4":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"7ea2":function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"p",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"k",(function(){return f})),n.d(t,"b",(function(){return m})),n.d(t,"d",(function(){return p})),n.d(t,"l",(function(){return b})),n.d(t,"m",(function(){return g})),n.d(t,"q",(function(){return h})),n.d(t,"h",(function(){return v})),n.d(t,"g",(function(){return _})),n.d(t,"i",(function(){return y})),n.d(t,"n",(function(){return $})),n.d(t,"o",(function(){return C})),n.d(t,"j",(function(){return x}));n("a5c9"),n("2769"),n("0756");var a=n("ff66"),o="/api/v1/clusters",s="/api/v1/clusters/logger/{cluster_name}",i="/api/v1/clusters/provisioner/log/{cluster_name}/{log_id}";function r(e){return Object(a["c"])("".concat(o,"/").concat(e))}function c(e){return Object(a["c"])("".concat(o,"/name/").concat(e))}function l(e){return Object(a["c"])("".concat(o,"/existence/").concat(e))}function u(e,t,n){return Object(a["e"])("".concat(o,"/search?pageNum=").concat(e,"&pageSize=").concat(t),n)}function d(e){return Object(a["e"])("".concat(o),e)}function f(e){return Object(a["c"])("".concat(o,"/health/").concat(e))}function m(e){return Object(a["e"])("".concat(o,"/recover/").concat(e),{})}function p(e,t){return Object(a["b"])("".concat(o,"/").concat(e,"?force=").concat(t))}function b(e){return Object(a["e"])("".concat(o,"/import/"),e)}function g(e){return Object(a["e"])("".concat(o,"/init/").concat(e,"/"),{})}function h(e,t){var n={clusterName:e,version:t};return Object(a["e"])("".concat(o,"/upgrade/"),n)}function v(e){return Object(a["c"])("".concat(o,"/status/").concat(e))}function _(e){return Object(a["c"])(s.replace("{cluster_name}",e))}function y(e,t){return Object(a["c"])(i.replace("{cluster_name}",e).replace("{log_id}",t))}function $(e){window.open("/ui/#/logger?clusterName=".concat(e),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function C(e,t){window.open("/ui/#/logger?clusterName=".concat(e,"&logId=").concat(t),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function x(e){return Object(a["c"])("".concat(o,"/secret/").concat(e))}},"86ca":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"complex-table"},[e.$slots.header||e.header?n("div",{staticClass:"complex-table__header"},[e._t("header",(function(){return[e._v(e._s(e.header))]})),e.$slots.toolbar||e.searchConfig?n("div",{staticClass:"complex-table__toolbar"},[n("div",[e._t("toolbar")],2),n("fu-search-bar",e._b({on:{exec:e.search},scopedSlots:e._u([{key:"complex",fn:function(){return[e._t("complex")]},proxy:!0}],null,!0)},"fu-search-bar",e.searchConfig,!1),[e._t("buttons"),n("fu-table-column-select",{attrs:{columns:e.columns}})],2)],1):e._e()],2):e._e(),n("div",{staticClass:"complex-table__body"},[n("fu-table",e._g(e._b({attrs:{columns:e.columns,"local-key":e.localKey},on:{"selection-change":e.handleSelectionChange}},"fu-table",e.$attrs,!1),e.$listeners),[e._t("default")],2)],1),e.$slots.pagination||e.paginationConfig?n("div",{staticClass:"complex-table__pagination"},[e._t("pagination",(function(){return[n("fu-table-pagination",e._b({attrs:{"current-page":e.paginationConfig.currentPage,"page-size":e.paginationConfig.pageSize},on:{"update:currentPage":function(t){return e.$set(e.paginationConfig,"currentPage",t)},"update:current-page":function(t){return e.$set(e.paginationConfig,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.paginationConfig,"pageSize",t)},"update:page-size":function(t){return e.$set(e.paginationConfig,"pageSize",t)},change:e.search}},"fu-table-pagination",e.paginationConfig,!1))]}))],2):e._e()])},o=[],s={name:"ComplexTable",props:{columns:{type:Array,default:function(){return[]}},localKey:String,header:String,searchConfig:Object,paginationConfig:Object,selects:Array},data:function(){return{condition:{}}},methods:{search:function(e,t){e&&(this.condition=e),this.$emit("search",this.condition,t)},handleSelectionChange:function(e){this.$emit("update:selects",e)}}},i=s,r=(n("1a55"),n("5d22")),c=Object(r["a"])(i,a,o,!1,null,null,null);t["a"]=c.exports},"9e34":function(e,t,n){},cacb:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return d}));n("2769"),n("0756");var a=n("ff66"),o="/proxy/kubernetes/{cluster_name}/{resource_url}",s="apis/apps/v1/deployments",i="apis/apps/v1/namespaces/{namespace}/deployments",r="api/v1/pods",c="api/v1/namespaces/{namespace}/pods/";function l(e,t,n){var r=o.replace("{cluster_name}",e);return r=void 0!==n&&null!==n?r.replace("{resource_url}",i).replace("{namespace}",n):r.replace("{resource_url}",s),Object(a["c"])(r)}function u(e,t,n){var s=o.replace("{cluster_name}",e);return s=void 0!==n&&null!==n?s.replace("{resource_url}",c).replace("{namespace}",n):s.replace("{resource_url}",r),Object(a["c"])(s)}function d(e){return Object(a["c"])("/api/v1/clusters/webkubectl/".concat(e,"?l=zh-CN"))}},ebf3:function(e,t,n){"use strict";n.d(t,"g",(function(){return m})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b})),n.d(t,"e",(function(){return g})),n.d(t,"d",(function(){return h})),n.d(t,"f",(function(){return v})),n.d(t,"h",(function(){return _})),n.d(t,"c",(function(){return y})),n.d(t,"i",(function(){return $}));n("2769"),n("0756"),n("a5c9");var a=n("ff66"),o="/proxy/kubernetes/{cluster_name}/{resource_url}",s=10,i="/api/v1/nodes",r="api/v1/namespaces/{namespace}/pods/{pod}/eviction",c="apis/metrics.k8s.io/v1beta1/nodes",l="/api/v1/clusters/node/{clusterName}",u="/api/v1/clusters/node/detail/{clusterName}/{node}",d="/api/v1/clusters/node/batch/{clusterName}",f="/api/v1/clusters/node/recreate/{clusterName}/{node}";function m(e,t){var n=o.replace("{cluster_name}",e).replace("{resource_url}",c);return n+="?limit="+s,void 0!==t&&null!==t&&(n+="&continue="+t),Object(a["c"])(n)}function p(e,t,n){var s={"Content-Type":"application/strategic-merge-patch+json"},r=o.replace("{cluster_name}",e).replace("{resource_url}",i)+"/"+t;return Object(a["d"])(r,n,s)}function b(e,t,n,s){var i=o.replace("{cluster_name}",e).replace("{resource_url}",r).replace("{namespace}",t).replace("{pod}",n);return Object(a["e"])(i,s)}function g(e){return Object(a["c"])("/api/v1/clusters/node/".concat(e))}function h(e,t){var n=o.replace("{cluster_name}",e).replace("{resource_url}",i);return void 0!==t&&null!==t&&(n+="&continue="+t),Object(a["c"])(n)}function v(e,t,n){return Object(a["c"])(l.replace("{clusterName}",e)+"?pageNum=".concat(t,"&pageSize=").concat(n))}function _(e,t){return Object(a["e"])(d.replace("{clusterName}",e),t)}function y(e,t){return Object(a["c"])(u.replace("{clusterName}",e).replace("{node}",t))}function $(e,t){return Object(a["e"])(f.replace("{clusterName}",e).replace("{node}",t))}},ecf1:function(e,t,n){"use strict";var a=n("6c87"),o=n("9f69"),s=n("e08f"),i=n("78d4"),r=n("1392");a("search",(function(e,t,n){return[function(t){var n=s(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,n):new RegExp(t)[e](String(n))},function(e){var a=n(t,this,e);if(a.done)return a.value;var s=o(this),c=String(e),l=s.lastIndex;i(l,0)||(s.lastIndex=0);var u=r(s,c);return i(s.lastIndex,l)||(s.lastIndex=l),null===u?-1:u.index}]}))}}]);
//# sourceMappingURL=chunk-222eccc1.ecd75020.js.map