(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3961d0b6"],{1276:function(t,e,n){"use strict";var r=n("d784"),a=n("44e7"),c=n("825a"),o=n("1d80"),i=n("4840"),s=n("8aa5"),u=n("50c4"),l=n("577e"),d=n("14c3"),f=n("9263"),h=n("9f7f"),p=n("d039"),b=h.UNSUPPORTED_Y,m=[].push,v=Math.min,g=4294967295,_=!p((function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));r("split",(function(t,e,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,n){var r=l(o(this)),c=void 0===n?g:n>>>0;if(0===c)return[];if(void 0===t)return[r];if(!a(t))return e.call(r,t,c);var i,s,u,d=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,b=new RegExp(t.source,h+"g");while(i=f.call(b,r)){if(s=b.lastIndex,s>p&&(d.push(r.slice(p,i.index)),i.length>1&&i.index<r.length&&m.apply(d,i.slice(1)),u=i[0].length,p=s,d.length>=c))break;b.lastIndex===i.index&&b.lastIndex++}return p===r.length?!u&&b.test("")||d.push(""):d.push(r.slice(p)),d.length>c?d.slice(0,c):d}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e,[function(e,n){var a=o(this),c=void 0==e?void 0:e[t];return void 0!==c?c.call(e,a,n):r.call(l(a),e,n)},function(t,a){var o=c(this),f=l(t),h=n(r,o,f,a,r!==e);if(h.done)return h.value;var p=i(o,RegExp),m=o.unicode,_=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(b?"g":"y"),y=new p(b?"^(?:"+o.source+")":o,_),w=void 0===a?g:a>>>0;if(0===w)return[];if(0===f.length)return null===d(y,f)?[f]:[];var k=0,V=0,j=[];while(V<f.length){y.lastIndex=b?0:V;var O,S=d(y,b?f.slice(V):f);if(null===S||(O=v(u(y.lastIndex+(b?V:0)),f.length))===k)V=s(f,V,m);else{if(j.push(f.slice(k,V)),j.length===w)return j;for(var C=1;C<=S.length-1;C++)if(j.push(S[C]),j.length===w)return j;V=k=O}}return j.push(f.slice(k)),j}]}),!_,b)},"396f":function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return o}));var r=n("ff66"),a="/api/v1/manifests";function c(){return Object(r["c"])("".concat(a,"/group"))}function o(){return Object(r["c"])("".concat(a,"/active"))}},"7ea2":function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"f",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"p",(function(){return l})),n.d(e,"c",(function(){return d})),n.d(e,"k",(function(){return f})),n.d(e,"b",(function(){return h})),n.d(e,"d",(function(){return p})),n.d(e,"l",(function(){return b})),n.d(e,"m",(function(){return m})),n.d(e,"q",(function(){return v})),n.d(e,"h",(function(){return g})),n.d(e,"g",(function(){return _})),n.d(e,"i",(function(){return y})),n.d(e,"n",(function(){return w})),n.d(e,"o",(function(){return k})),n.d(e,"j",(function(){return V}));n("99af"),n("ac1f"),n("5319");var r=n("ff66"),a="/api/v1/clusters",c="/api/v1/clusters/logger/{cluster_name}",o="/api/v1/clusters/provisioner/log/{cluster_name}/{log_id}";function i(t){return Object(r["c"])("".concat(a,"/").concat(t))}function s(t){return Object(r["c"])("".concat(a,"/name/").concat(t))}function u(t){return Object(r["c"])("".concat(a,"/existence/").concat(t))}function l(t,e,n){return Object(r["e"])("".concat(a,"/search?pageNum=").concat(t,"&pageSize=").concat(e),n)}function d(t){return Object(r["e"])("".concat(a),t)}function f(t){return Object(r["c"])("".concat(a,"/health/").concat(t))}function h(t){return Object(r["e"])("".concat(a,"/recover/").concat(t),{})}function p(t,e){return Object(r["b"])("".concat(a,"/").concat(t,"?force=").concat(e))}function b(t){return Object(r["e"])("".concat(a,"/import/"),t)}function m(t){return Object(r["e"])("".concat(a,"/init/").concat(t,"/"),{})}function v(t,e){var n={clusterName:t,version:e};return Object(r["e"])("".concat(a,"/upgrade/"),n)}function g(t){return Object(r["c"])("".concat(a,"/status/").concat(t))}function _(t){return Object(r["c"])(c.replace("{cluster_name}",t))}function y(t,e){return Object(r["c"])(o.replace("{cluster_name}",t).replace("{log_id}",e))}function w(t){window.open("/ui/#/logger?clusterName=".concat(t),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function k(t,e){window.open("/ui/#/logger?clusterName=".concat(t,"&logId=").concat(e),"_blank","height=865, width=800, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=yes,location=no, status=no")}function V(t){return Object(r["c"])("".concat(a,"/secret/").concat(t))}},8767:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layout-content",{attrs:{header:t.$t("commons.button.upgrade"),"back-to":{name:"ClusterList"}}},[n("el-row",[n("el-col",{attrs:{span:4}},[n("br")]),n("el-col",{attrs:{span:10}},[n("div",{staticClass:"grid-content bg-purple-light"},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:t.$t("cluster.version"),prop:"version"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{clearable:""},on:{change:t.changeUpgradeVersions},model:{value:t.form.version,callback:function(e){t.$set(t.form,"version",e)},expression:"form.version"}},t._l(t.upgradeVersions,(function(e){return n("el-option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1),0===t.upgradeVersions.length?n("div",[n("span",{staticClass:"input-help"},[t._v(t._s(t.$t("cluster.upgrade.upgrade_help")))])]):t._e()],1),n("el-form-item",[0!==t.newManifest.coreVars.length&&0!==t.oldManifest.coreVars?n("div",[n("table",{staticClass:"myTable",staticStyle:{width:"100%"}},[n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v(t._s(t.$t("commons.table.name")))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.$t("cluster.upgrade.current_version")))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.$t("cluster.upgrade.upgrade_version")))])]),n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Kubernetes")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("kubernetes",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("kubernetes",t.newManifest.coreVars)))])]),t.getVersion("etcd",t.oldManifest.coreVars)!==t.getVersion("etcd",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("ETCD")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("etcd",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("etcd",t.newManifest.coreVars)))])]):t._e(),"docker"==t.currentCluster.spec.runtimeType&&t.getVersion("docker",t.oldManifest.coreVars)!==t.getVersion("docker",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Docker")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("docker",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("docker",t.newManifest.coreVars)))])]):t._e(),"containerd"==t.currentCluster.spec.runtimeType&&t.getVersion("containerd",t.oldManifest.coreVars)!==t.getVersion("containerd",t.newManifest.coreVars)?n("tr",[n("td",{staticStyle:{width:"40%"}},[t._v("Containerd")]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("containerd",t.oldManifest.coreVars)))]),n("td",{staticStyle:{width:"30%"}},[t._v(t._s(t.getVersion("containerd",t.newManifest.coreVars)))])]):t._e()])]):t._e()]),n("el-form-item",{staticStyle:{float:"right"}},[n("el-button",{on:{click:function(e){return t.onCancel()}}},[t._v(t._s(t.$t("commons.button.cancel")))]),n("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loadding,expression:"loadding"}],attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("commons.button.ok")))])],1)],1)],1)])],1)],1)},a=[],c=n("b85c"),o=(n("b0c0"),n("ac1f"),n("1276"),n("a9e3"),n("159b"),n("be17")),i=n("7ea2"),s=n("396f"),u=n("0792"),l={name:"ClusterUpgrade",props:["name"],components:{LayoutContent:o["a"]},data:function(){return{loadding:!1,form:{clusterName:"",version:""},rules:{version:[u["a"].RequiredRule]},oldManifest:{coreVars:[]},newManifest:{coreVars:[]},upgradeVersions:[],manifestList:[]}},methods:{onSubmit:function(){var t=this;this.$refs["form"].validate((function(e){e&&(t.loadding=!0,Object(i["q"])(t.form.clusterName,t.form.version).then((function(){t.loadding=!1,t.$message({type:"success",message:t.$t("commons.msg.upgrade_start_success")}),t.$router.push({name:"ClusterList"})})).catch((function(){t.loadding=!1})))}))},loadInfo:function(t){var e=this;Object(i["e"])(t).then((function(t){e.currentCluster=t,e.form.clusterName=t.name;var n=t.spec.version,r=n.split("."),a=r[0],o=r[1],i=r[2].split("-ko"),u=Number(i[0]),l=Number(i[1]);e.upgradeVersions=[],Object(s["b"])().then((function(t){var n,r=Object(c["a"])(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.clusterManifests.forEach((function(t){e.manifestList.push(t)}))}}catch(_){r.e(_)}finally{r.f()}var s,d=Object(c["a"])(e.manifestList);try{for(d.s();!(s=d.n()).done;){var f=s.value;if(f.isActive){var h=f.name.split("-ko"),p=h[0].split("."),b=Number(h[1]),m=p[0],v=p[1],g=Number(p[2]);a===m&&o===v&&(g>u&&e.upgradeVersions.push(f.name),g===u&&l<b&&e.upgradeVersions.push(f.name))}}}catch(_){d.e(_)}finally{d.f()}}))}))},changeUpgradeVersions:function(){var t,e=Object(c["a"])(this.manifestList);try{for(e.s();!(t=e.n()).done;){var n=t.value;-1!==n.name.indexOf(this.currentCluster.spec.version)&&(this.oldManifest=n),n.name===this.form.version&&(this.newManifest=n)}}catch(r){e.e(r)}finally{e.f()}},getVersion:function(t,e){var n,r=Object(c["a"])(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===t)return a.version}}catch(o){r.e(o)}finally{r.f()}},onCancel:function(){this.$router.push({name:"ClusterList"})}},created:function(){this.loadInfo(this.$route.params.name)}},d=l,f=n("2877"),h=Object(f["a"])(d,r,a,!1,null,"9d2e1136",null);e["default"]=h.exports},"992c":function(t,e,n){t.exports={theme:"#5354bb"}},a026:function(t,e,n){"use strict";n("992c")},b85c:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");var r=n("06c5");function a(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Object(r["a"])(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var a=0,c=function(){};return{s:c,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n["return"]||n["return"]()}finally{if(s)throw o}}}}},be17:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content-container"},[t.$slots.description||t.description?n("div",{staticClass:"content-container__description"},[n("el-alert",{attrs:{title:t.description,type:"info"}}),n("br")],1):t._e(),t.$slots.header||t.header?n("div",{staticClass:"content-container__header"},[t._t("header",(function(){return[t.showBack?n("back-button",{attrs:{path:t.backPath,name:t.backName,to:t.backTo}}):t._e(),t._v(" "+t._s(t.header)+" ")]}))],2):t._e(),t.$slots.toolbar?n("div",{staticClass:"content-container__toolbar"},[t._t("toolbar")],2):t._e(),t._t("default")],2)},a=[],c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-icon",{staticClass:"back-button",attrs:{name:"back"},nativeOn:{click:function(e){return t.jump.apply(null,arguments)}}})},o=[],i=(n("b0c0"),{name:"BackButton",props:{path:String,name:String,to:Object},methods:{jump:function(){var t=this.path,e=this.name,n=this.to;t&&this.$router.push(t),e&&this.$router.push(e),n&&this.$router.push(n)}}}),s=i,u=(n("eb9f"),n("2877")),l=Object(u["a"])(s,c,o,!1,null,null,null),d=l.exports,f={name:"LayoutContent",components:{BackButton:d},props:{header:String,description:String,backPath:String,backName:String,backTo:Object},computed:{showBack:function(t){var e=t.backPath,n=t.backName,r=t.backTo;return e||n||r}}},h=f,p=(n("a026"),Object(u["a"])(h,r,a,!1,null,null,null));e["a"]=p.exports},eb9f:function(t,e,n){"use strict";n("f574")},f574:function(t,e,n){t.exports={theme:"#5354bb"}}}]);
//# sourceMappingURL=chunk-3961d0b6.cbcf4768.js.map