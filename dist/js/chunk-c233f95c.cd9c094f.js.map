{"version":3,"sources":["webpack:///./src/business/clusters/detail/log/loki/index.vue?cf10","webpack:///src/business/clusters/detail/log/loki/index.vue","webpack:///./src/business/clusters/detail/log/loki/index.vue?4d30","webpack:///./src/business/clusters/detail/log/loki/index.vue","webpack:///./src/api/cluster/log.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","$t","model","value","searchruleForm","callback","$$v","$set","expression","on","$event","searchWithLabel","_l","item","key","label","length","search","_v","_s","directives","name","rawName","data","scopedSlots","_u","fn","ref","row","_f","ts","staticRenderFns","components","loading","clusterName","timeRange","labels","values","methods","getLables","start","getTime","end","paramInfo","step","undefined","dataParser","Date","parseInt","substring","info","logItem","created","$route","params","component","efBaseUrl","lokiBaseUrl","EfSearch","queryArry","queryIndex","beginDate","endDate","pageFrom","pageSize","index","query","from","size","bool","must","filter","range","gte","lte","format","time_zone","sort","post","replace","LokiLabels","LokiLabelValues","LokiSearch"],"mappings":"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","file":"js/chunk-c233f95c.cd9c094f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-form',{attrs:{\"inline\":true}},[_c('el-form-item',{attrs:{\"label\":_vm.$t('commons.search.time')}},[_c('el-date-picker',{attrs:{\"type\":\"daterange\",\"range-separator\":_vm.$t('commons.search.time_range'),\"start-placeholder\":_vm.$t('commons.search.date_start'),\"end-placeholder\":_vm.$t('commons.search.date_end')},model:{value:(_vm.searchruleForm.timeRange),callback:function ($$v) {_vm.$set(_vm.searchruleForm, \"timeRange\", $$v)},expression:\"searchruleForm.timeRange\"}})],1),_c('el-form-item',{attrs:{\"label\":_vm.$t('cluster.detail.log.label')}},[_c('el-select',{attrs:{\"size\":\"small\",\"clearable\":\"\",\"allow-create\":\"\",\"filterable\":\"\"},on:{\"change\":function($event){return _vm.searchWithLabel()}},model:{value:(_vm.searchruleForm.label),callback:function ($$v) {_vm.$set(_vm.searchruleForm, \"label\", $$v)},expression:\"searchruleForm.label\"}},_vm._l((_vm.labels),function(item){return _c('el-option',{key:item,attrs:{\"label\":item,\"value\":item}})}),1)],1),_c('el-form-item',{attrs:{\"label\":_vm.$t('cluster.detail.log.value')}},[_c('el-select',{attrs:{\"size\":\"small\",\"clearable\":\"\",\"allow-create\":\"\",\"filterable\":\"\"},model:{value:(_vm.searchruleForm.value),callback:function ($$v) {_vm.$set(_vm.searchruleForm, \"value\", $$v)},expression:\"searchruleForm.value\"}},_vm._l((_vm.values),function(item){return _c('el-option',{key:item,attrs:{\"label\":item,\"value\":item}})}),1)],1),_c('el-button',{attrs:{\"disabled\":_vm.searchruleForm.label.length === 0 || _vm.searchruleForm.value.length === 0,\"size\":\"small\"},on:{\"click\":function($event){return _vm.search()}}},[_vm._v(_vm._s(_vm.$t('commons.button.search')))])],1),_c('complex-table',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"data\":_vm.data}},[_c('el-table-column',{attrs:{\"min-width\":\"25%\",\"label\":_vm.$t('cluster.detail.log.time')},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar row = ref.row;\nreturn [_vm._v(\" \"+_vm._s(_vm._f(\"datetimeFormat\")(row.ts))+\" \")]}}])}),_c('el-table-column',{attrs:{\"label\":_vm.$t('cluster.detail.log.msg_info'),\"min-width\":\"100\",\"prop\":\"info\",\"fix\":\"\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <el-form :inline=\"true\">\n      <el-form-item :label=\"$t('commons.search.time')\">\n        <el-date-picker v-model=\"searchruleForm.timeRange\" type=\"daterange\" :range-separator=\"$t('commons.search.time_range')\" :start-placeholder=\"$t('commons.search.date_start')\" :end-placeholder=\"$t('commons.search.date_end')\">\n        </el-date-picker>\n      </el-form-item>\n      <el-form-item :label=\"$t('cluster.detail.log.label')\">\n        <el-select size=\"small\" @change=\"searchWithLabel()\" clearable allow-create filterable v-model=\"searchruleForm.label\">\n          <el-option v-for=\"item in labels\" :key=\"item\" :label=\"item\" :value=\"item\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item :label=\"$t('cluster.detail.log.value')\">\n        <el-select size=\"small\" clearable allow-create filterable v-model=\"searchruleForm.value\">\n          <el-option v-for=\"item in values\" :key=\"item\" :label=\"item\" :value=\"item\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-button :disabled=\"searchruleForm.label.length === 0 || searchruleForm.value.length === 0\" @click=\"search()\" size=\"small\">{{$t('commons.button.search')}}</el-button>\n    </el-form>\n\n    <complex-table :data=\"data\" v-loading=\"loading\">\n      <el-table-column min-width=\"25%\" :label=\"$t('cluster.detail.log.time')\">\n        <template v-slot:default=\"{row}\">\n          {{ row.ts | datetimeFormat }}\n        </template>\n      </el-table-column>\n      <el-table-column :label=\"$t('cluster.detail.log.msg_info')\" min-width=\"100\" prop=\"info\" fix />\n    </complex-table>\n  </div>\n</template>\n\n<script>\nimport ComplexTable from \"@/components/complex-table\"\nimport { LokiLabels, LokiLabelValues, LokiSearch } from \"@/api/cluster/log\"\n\nexport default {\n  name: \"ClusterLoki\",\n  components: { ComplexTable },\n  data() {\n    return {\n      loading: false,\n      clusterName: \"\",\n      searchruleForm: {\n        timeRange: [],\n        label: \"\",\n        value: \"\",\n      },\n      labels: [],\n      values: [],\n      data: [],\n    }\n  },\n  methods: {\n    getLables() {\n      LokiLabels(this.clusterName).then((data) => {\n        this.labels = data.data\n      })\n    },\n    search() {\n      this.loading = true\n      this.data = []\n      let step = 8\n      let paramInfo = \"direction=backward&limit=1000&regexp=\"\n      let start = 0\n      let end = 0\n\n      if (this.searchruleForm.timeRange.length !== 0) {\n        start = this.searchruleForm.timeRange[0].getTime()\n        end = this.searchruleForm.timeRange[1].getTime()\n        paramInfo = paramInfo + (\"&start=\" + start + \"000000&end=\" + (end + 86400000) + \"000000\")\n      }\n      step = ((end - start) / 86400000 + 1) * 8\n      paramInfo = paramInfo + \"&step=\" + step\n\n      if (this.searchruleForm.label !== \"\" && this.searchruleForm.value !== \"\") {\n        paramInfo += \"&query={\" + this.searchruleForm.label + '=\"' + this.searchruleForm.value + '\"}'\n      }\n      LokiSearch(this.clusterName, paramInfo).then((data) => {\n        for (const item1 of data.data.result) {\n          for (const item2 of item1.values) {\n            let logItem = this.dataParser(item2)\n            this.data.push(logItem)\n          }\n        }\n        this.loading = false\n      })\n    },\n    searchWithLabel() {\n      if (this.searchruleForm.label) {\n        LokiLabelValues(this.clusterName, this.searchruleForm.label).then((data) => {\n          if (data.data === undefined) {\n            this.searchruleForm.values = []\n            this.searchruleForm.value = \"\"\n          } else {\n            if (data.data.length > 0) {\n              this.searchruleForm.values = data.data\n              this.searchruleForm.value = this.searchruleForm.values[0]\n            } else {\n              this.searchruleForm.values = []\n              this.searchruleForm.value = \"\"\n            }\n          }\n        })\n      }\n    },\n    dataParser(data) {\n      let logItem = {\n        ts: new Date(parseInt(data[0].substring(0, 13))),\n        info: data[1],\n      }\n      return logItem\n    },\n  },\n  created() {\n    this.clusterName = this.$route.params.name\n    this.getLables()\n  },\n}\n</script>\n\n<style scoped>\n</style>\n","import mod from \"-!../../../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--12-0!../../../../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../../../../node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js!../../../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--0-0!../../../../../../node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--12-0!../../../../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../../../../node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js!../../../../../../node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--0-0!../../../../../../node_modules/_vue-loader@15.9.6@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=f484b2d8&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/_vue-loader@15.9.6@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f484b2d8\",\n  null\n  \n)\n\nexport default component.exports","import {post} from \"@/plugins/request\"\n\nconst efBaseUrl = \"/proxy/logging/{cluster_name}/{index_name}/_search?pretty=true\"\nconst lokiBaseUrl = \"/proxy/loki/{cluster_name}/\"\n\nexport function EfSearch(clusterName, queryArry, queryIndex, beginDate, endDate, pageFrom, pageSize) {\n  const index = queryIndex\n  const query = {\n    from: (pageFrom - 1) * pageSize,\n    size: pageSize,\n    query: {\n      bool: {\n        must: queryArry,\n        filter: {\n          range: {\n            \"@timestamp\": {\n              gte: beginDate,\n              lte: endDate,\n              format: \"yyyy.MM.dd\",\n              time_zone: \"+08:00\"\n            }\n          }\n        }\n      }\n    },\n    sort: [\n      {\"@timestamp\": \"desc\"},\n    ]\n  }\n  return post(efBaseUrl.replace(\"{cluster_name}\", clusterName).replace(\"{index_name}\", index) + \"&ignore_unavailable=true\", query)\n}\nexport function LokiLabels(clusterName) {\n  return post(lokiBaseUrl.replace(\"{cluster_name}\", clusterName) + \"loki/api/v1/labels\", \"\")\n}\nexport function LokiLabelValues(clusterName, label) {\n  return post(lokiBaseUrl.replace(\"{cluster_name}\", clusterName) + \"loki/api/v1/label/{label}/values\".replace(\"{label}\", label), \"\")\n}\nexport function LokiSearch(clusterName, params) {\n  return post(lokiBaseUrl.replace(\"{cluster_name}\", clusterName) + \"loki/api/v1/query_range?\" + params, \"\")\n}\n"],"sourceRoot":""}