(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25db19ea"],{1460:function(e,t,r){var n=r("fdfe");e.exports=function(e){if("number"!=typeof e&&"Number"!=n(e))throw TypeError("Incorrect invocation");return+e}},5671:function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return o})),r.d(t,"d",(function(){return c}));var n=r("ff66"),a="/api/v1/clusters/tool";function i(e){return Object(n["c"])("".concat(a,"/").concat(e))}function s(e,t){return Object(n["e"])("".concat(a,"/enable/").concat(e),t)}function o(e,t){return Object(n["e"])("".concat(a,"/disable/").concat(e),t)}function c(e,t){return Object(n["e"])("".concat(a,"/upgrade/").concat(e),t)}},bbdf:function(e,t,r){"use strict";var n=r("599d"),a=r("e08f");e.exports=function(e){var t=String(a(this)),r="",i=n(e);if(i<0||i==1/0)throw RangeError("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r}},c5ce8:function(e,t,r){"use strict";var n=r("6c39"),a=r("9f69"),i=r("d50e"),s=r("f91c"),o="toString",c=RegExp.prototype,u=c[o],l=i((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),d=u.name!=o;(l||d)&&n(RegExp.prototype,o,(function(){var e=a(this),t=String(e.source),r=e.flags,n=String(void 0===r&&e instanceof RegExp&&!("flags"in c)?s.call(e):r);return"/"+t+"/"+n}),{unsafe:!0})},cbea:function(e,t,r){"use strict";var n=r("e450"),a=r("599d"),i=r("1460"),s=r("bbdf"),o=r("d50e"),c=1..toFixed,u=Math.floor,l=function(e,t,r){return 0===t?r:t%2===1?l(e,t-1,r*e):l(e*e,t/2,r)},d=function(e){var t=0,r=e;while(r>=4096)t+=12,r/=4096;while(r>=2)t+=1,r/=2;return t},m=function(e,t,r){var n=-1,a=r;while(++n<6)a+=t*e[n],e[n]=a%1e7,a=u(a/1e7)},p=function(e,t){var r=6,n=0;while(--r>=0)n+=e[r],e[r]=u(n/t),n=n%t*1e7},f=function(e){var t=6,r="";while(--t>=0)if(""!==r||0===t||0!==e[t]){var n=String(e[t]);r=""===r?n:r+s.call("0",7-n.length)+n}return r},h=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){c.call({})}));n({target:"Number",proto:!0,forced:h},{toFixed:function(e){var t,r,n,o,c=i(this),u=a(e),h=[0,0,0,0,0,0],g="",v="0";if(u<0||u>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(g="-",c=-c),c>1e-21)if(t=d(c*l(2,69,1))-69,r=t<0?c*l(2,-t,1):c/l(2,t,1),r*=4503599627370496,t=52-t,t>0){m(h,0,r),n=u;while(n>=7)m(h,1e7,0),n-=7;m(h,l(10,n,1),0),n=t-1;while(n>=23)p(h,1<<23),n-=23;p(h,1<<n),m(h,1,1),p(h,2),v=f(h)}else m(h,0,r),m(h,1<<-t,0),v=f(h)+s.call("0",u);return u>0?(o=v.length,v=g+(o<=u?"0."+s.call("0",u-o)+v:v.slice(0,o-u)+"."+v.slice(o-u))):v=g+v,v}})},d7dc:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{attrs:{inline:!0}},[r("el-form-item",{attrs:{label:e.$t("cluster.detail.log.monitor_node")}},[r("el-select",{attrs:{size:"small","allow-create":"",filterable:""},on:{change:function(t){return e.search()}},model:{value:e.searchruleForm.node,callback:function(t){e.$set(e.searchruleForm,"node",t)},expression:"searchruleForm.node"}},e._l(e.nodes,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:e.$t("commons.search.time")}},[r("el-date-picker",{attrs:{type:"datetimerange","range-separator":e.$t("commons.search.time_range"),"start-placeholder":e.$t("commons.search.time_start"),"end-placeholder":e.$t("commons.search.time_end")},on:{change:function(t){return e.search()}},model:{value:e.searchruleForm.timeRange,callback:function(t){e.$set(e.searchruleForm,"timeRange",t)},expression:"searchruleForm.timeRange"}})],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-card",{staticStyle:{overflow:"inherit"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_cpu,expression:"loading_cpu"}],staticStyle:{width:"100%",height:"350%","margin-top":"40px"},attrs:{id:"cpuChart"}})])],1),r("el-col",{attrs:{span:12}},[r("el-card",{staticStyle:{overflow:"inherit"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_memory,expression:"loading_memory"}],staticStyle:{width:"100%",height:"350%","margin-top":"40px"},attrs:{id:"memoryChart"}})])],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-card",{staticStyle:{overflow:"inherit"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_disk,expression:"loading_disk"}],staticStyle:{width:"100%",height:"350%","margin-top":"40px"},attrs:{id:"diskChart"}})])],1),r("el-col",{attrs:{span:12}},[r("el-card",{staticStyle:{overflow:"inherit"}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_network,expression:"loading_network"}],staticStyle:{width:"100%",height:"350%","margin-top":"40px"},attrs:{id:"networkChart"}})])],1)],1)],1)},a=[],i=r("30d5"),s=(r("eb62"),r("b1fa"),r("c5ce8"),r("af21"),r("cbea"),r("e1d4"),r("2e6f"),r("f5bd"),r("2769"),r("ecf1"),r("ebf3")),o=r("5671"),c=(r("0756"),r("ff66")),u="/proxy/prometheus/{cluster_name}/",l='api/v1/query_range?query=sum by(instance)(irate(node_cpu_seconds_total{instance="{instance}", mode={mode}}[5m])) * 100&start={start}&end={end}&step=300',d='api/v1/query_range?query=node_memory_MemTotal_bytes{instance="{instance}"}&start={start}&end={end}&step=300',m='api/v1/query_range?query=node_memory_MemTotal_bytes{instance="{instance}"} - node_memory_MemFree_bytes{instance="{instance}"} - (node_memory_Cached_bytes{instance="{instance}"}%2Bnode_memory_Buffers_bytes{instance="{instance}"})&start={start}&end={end}&step=300',p='api/v1/query_range?query=node_memory_Cached_bytes{instance="{instance}"}%2Bnode_memory_Buffers_bytes{instance="{instance}"}&start={start}&end={end}&step=300',f='api/v1/query_range?query=node_memory_MemFree_bytes{instance="{instance}"}&start={start}&end={end}&step=300',h='api/v1/query_range?query=(node_memory_SwapTotal_bytes{instance="{instance}"} - node_memory_SwapFree_bytes{instance="{instance}"})&start={start}&end={end}&step=300',g='api/v1/query_range?query=100 - ((node_filesystem_avail_bytes{instance="{instance}",device!~"rootfs"} * 100) / node_filesystem_size_bytes{instance="{instance}",device!~"rootfs"})&start={start}&end={end}&step=300',v='api/v1/query_range?query=irate(node_network_receive_bytes_total{instance="{instance}"}[5m])*8&start={start}&end={end}&step=300',_='api/v1/query_range?query=irate(node_network_transmit_bytes_total{instance="{instance}"}[5m])*8&start={start}&end={end}&step=300';function y(e,t,r,n,a){return Object(c["c"])(u.replace("{cluster_name}",e)+l.replace(/{instance}/g,t).replace(/{mode}/g,r).replace("{start}",n).replace("{end}",a))}function b(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+d.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function w(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+m.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function S(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+p.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function k(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+f.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function F(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+h.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function N(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+g.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function x(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+v.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}function D(e,t,r,n){return Object(c["c"])(u.replace("{cluster_name}",e)+_.replace(/{instance}/g,t).replace("{start}",r).replace("{end}",n))}var L=r("43a0"),j={name:"ClusterMonitor",components:{},data:function(){return{startDate:Date.now(),loading_cpu:!1,loading_memory:!1,loading_disk:!1,loading_network:!1,searchruleForm:{node:"",timeRange:[]},nodes:[],cpuDateList:[],cpuValueList:[],memoryDateList:[],memoryValueList:[],diskDateList:[],diskValueList:[],networkDateList:[],networkValueList:[],data:[]}},methods:{search:function(){var e=this;this.loading_cpu=!0,this.loading_memory=!0,this.loading_disk=!0,this.loading_network=!0,Object(s["e"])(this.clusterName).then((function(t){e.nodes=t.items.map((function(e){return e.ip})),e.searchruleForm.node=e.searchruleForm.node?e.searchruleForm.node:e.nodes[0],e.searchruleForm.timeRange||(e.searchruleForm.timeRange=[]),0===e.searchruleForm.timeRange.length&&(e.searchruleForm.timeRange[0]=new Date((new Date).setMinutes((new Date).getMinutes()-30)),e.searchruleForm.timeRange[1]=new Date);var r=e.searchruleForm.timeRange[0].getTime()/1e3,n=e.searchruleForm.timeRange[1].getTime()/1e3;e.getCPUDatas(r,n),e.getMemoryDatas(r,n),e.getDiskDatas(r,n),e.getNetworkDatas(r,n)}))},getCPUDatas:function(e,t){var r=this;this.cpuDateList=[],this.cpuValueList=[];var n=new Promise((function(n){y(r.clusterName,r.searchruleForm.node+":9100",'"system"',e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(r.cpuDateList=e.data.result[0].values.map((function(e){var t=new Date(1e3*e[0]);return t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+t.getMinutes()})),t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.cpuValueList.push(r.addSeries(t,"Busy System")),n()}))})),a=new Promise((function(n){y(r.clusterName,r.searchruleForm.node+":9100",'"user"',e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.cpuValueList.push(r.addSeries(t,"Busy User")),n()}))})),i=new Promise((function(n){y(r.clusterName,r.searchruleForm.node+":9100",'"iowait"',e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.cpuValueList.push(r.addSeries(t,"Busy Iowait")),n()}))})),s=new Promise((function(n){y(r.clusterName,r.searchruleForm.node+":9100",'"idle"',e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.cpuValueList.push(r.addSeries(t,"Busy Idle")),n()}))})),o=new Promise((function(n){y(r.clusterName,r.searchruleForm.node+":9100",'~".*irq"',e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.cpuValueList.push(r.addSeries(t,"Busy Irqs")),n()}))}));Promise.all([n,a,i,s,o]).then((function(){r.loading_cpu=!1,r.initCharts("cpuChart","CPU Basic",r.cpuDateList,r.cpuValueList,"%")})).catch((function(){r.loading_cpu=!1}))},getMemoryDatas:function(e,t){var r=this;this.memoryDateList=[],this.memoryValueList=[];var n=new Promise((function(n){b(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(r.memoryDateList=e.data.result[0].values.map((function(e){var t=new Date(1e3*e[0]);return t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+t.getMinutes()})),t=e.data.result[0].values.map((function(e){return(Number(e[1])/1024/1024/1024).toFixed(2)}))),r.memoryValueList.push(r.addSeries(t,"RAM Total")),n()}))})),a=new Promise((function(n){w(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return(Number(e[1])/1024/1024/1024).toFixed(2)}))),r.memoryValueList.push(r.addSeries(t,"RAM Used")),n()}))})),i=new Promise((function(n){S(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return(Number(e[1])/1024/1024/1024).toFixed(2)}))),r.memoryValueList.push(r.addSeries(t,"RAM Cache + Buffer")),n()}))})),s=new Promise((function(n){k(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return(Number(e[1])/1024/1024/1024).toFixed(2)}))),r.memoryValueList.push(r.addSeries(t,"RAM Free")),n()}))})),o=new Promise((function(n){F(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(t=e.data.result[0].values.map((function(e){return(Number(e[1])/1024/1024/1024).toFixed(2)}))),r.memoryValueList.push(r.addSeries(t,"SWAP Used")),n()}))}));Promise.all([n,a,i,s,o]).then((function(){r.loading_memory=!1,r.initCharts("memoryChart","Memory Basic",r.memoryDateList,r.memoryValueList,"GiB")})).catch((function(){r.loading_memory=!1}))},getDiskDatas:function(e,t){var r=this;this.diskDateList=[],this.diskValueList=[],N(this.clusterName,this.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t=[];0!==e.data.result.length&&(r.diskDateList=e.data.result[0].values.map((function(e){var t=new Date(1e3*e[0]);return t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+t.getMinutes()})),t=e.data.result[0].values.map((function(e){return Number(e[1]).toFixed(2)}))),r.diskValueList.push(r.addSeries(t,"Disk Space Used")),r.loading_disk=!1,r.initCharts("diskChart","Disk Space Used Basic",r.diskDateList,r.diskValueList,"%")})).catch((function(){r.loading_disk=!1}))},getNetworkDatas:function(e,t){var r=this;this.networkDateList=[],this.networkValueList=[];var n=new Promise((function(n){x(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){if(0!==e.data.result.length){r.networkDateList=e.data.result[0].values.map((function(e){var t=new Date(1e3*e[0]);return t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+t.getMinutes()}));var t,a=Object(i["a"])(e.data.result);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=[];o=s.values.map((function(e){return(Number(e[1])/1e3).toFixed(0)})),r.networkValueList.push(r.addSeries(o,"Recv "+s.metric.device))}}catch(c){a.e(c)}finally{a.f()}}n()}))})),a=new Promise((function(n){D(r.clusterName,r.searchruleForm.node+":9100",e.toString(),t.toString()).then((function(e){var t,a=Object(i["a"])(e.data.result);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=[];o=s.values.map((function(e){return-(Number(e[1])/1e3).toFixed(0)})),r.networkValueList.push(r.addSeries(o,"Trans "+s.metric.device))}}catch(c){a.e(c)}finally{a.f()}n()}))}));Promise.all([n,a]).then((function(){r.loading_network=!1,r.initCharts("networkChart","Network Traffic Basic",r.networkDateList,r.networkValueList,"kb/s")})).catch((function(){r.loading_network=!1}))},initCharts:function(e,t,r,n,a){var s=L.init(document.getElementById(e)),o={title:[{left:"center",text:t}],tooltip:{trigger:"axis",formatter:function(e){var t,r=e[0].name+"<br/>",n=Object(i["a"])(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;r+=s.marker+" "+s.seriesName+"："+s.data+a+"<br/>"}}catch(o){n.e(o)}finally{n.f()}return r},textStyle:{align:"left"}},xAxis:[{data:r,gridIndex:1}],yAxis:[{axisLabel:{formatter:"{value} "+a},gridIndex:1}],grid:[{bottom:"60%"},{left:"20%"},{top:"15%"}],series:n};s.setOption(o,!0)},addSeries:function(e,t){return{name:t,type:"line",smooth:!0,showSymbol:!0,areaStyle:{},data:e}}},mounted:function(){var e=this;this.clusterName=this.$route.params.name,Object(o["c"])(this.clusterName).then((function(t){var r,n=Object(i["a"])(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;"prometheus"===a.name&&(e.startDate=new Date(a.updatedAt).getTime())}}catch(s){n.e(s)}finally{n.f()}})),this.search()}},O=j,V=r("5d22"),M=Object(V["a"])(O,n,a,!1,null,"77de975f",null);t["default"]=M.exports},ebf3:function(e,t,r){"use strict";r.d(t,"g",(function(){return p})),r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return h})),r.d(t,"e",(function(){return g})),r.d(t,"d",(function(){return v})),r.d(t,"f",(function(){return _})),r.d(t,"h",(function(){return y})),r.d(t,"c",(function(){return b})),r.d(t,"i",(function(){return w}));r("2769"),r("0756"),r("a5c9");var n=r("ff66"),a="/proxy/kubernetes/{cluster_name}/{resource_url}",i=10,s="/api/v1/nodes",o="api/v1/namespaces/{namespace}/pods/{pod}/eviction",c="apis/metrics.k8s.io/v1beta1/nodes",u="/api/v1/clusters/node/{clusterName}",l="/api/v1/clusters/node/detail/{clusterName}/{node}",d="/api/v1/clusters/node/batch/{clusterName}",m="/api/v1/clusters/node/recreate/{clusterName}/{node}";function p(e,t){var r=a.replace("{cluster_name}",e).replace("{resource_url}",c);return r+="?limit="+i,void 0!==t&&null!==t&&(r+="&continue="+t),Object(n["c"])(r)}function f(e,t,r){var i={"Content-Type":"application/strategic-merge-patch+json"},o=a.replace("{cluster_name}",e).replace("{resource_url}",s)+"/"+t;return Object(n["d"])(o,r,i)}function h(e,t,r,i){var s=a.replace("{cluster_name}",e).replace("{resource_url}",o).replace("{namespace}",t).replace("{pod}",r);return Object(n["e"])(s,i)}function g(e){return Object(n["c"])("/api/v1/clusters/node/".concat(e))}function v(e,t){var r=a.replace("{cluster_name}",e).replace("{resource_url}",s);return void 0!==t&&null!==t&&(r+="&continue="+t),Object(n["c"])(r)}function _(e,t,r){return Object(n["c"])(u.replace("{clusterName}",e)+"?pageNum=".concat(t,"&pageSize=").concat(r))}function y(e,t){return Object(n["e"])(d.replace("{clusterName}",e),t)}function b(e,t){return Object(n["c"])(l.replace("{clusterName}",e).replace("{node}",t))}function w(e,t){return Object(n["e"])(m.replace("{clusterName}",e).replace("{node}",t))}}}]);
//# sourceMappingURL=chunk-25db19ea.1715c020.js.map